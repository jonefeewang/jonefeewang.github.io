<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="695" height="648" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot; version=&quot;7.9.5&quot; editor=&quot;www.draw.io&quot;&gt;&lt;diagram id=&quot;93847e8c-2cbb-071f-0b92-3fe37a6f9f7a&quot; name=&quot;第 1 页&quot;&gt;7Zzdj5s4EMD/GkvtQyvAfD5ikvSk3kmV9qT7eGMTb4JK4hxhu9v762/GGAcM2eaykK4U8rALg7HHMz+PzeCE0GT7/KlI95vfxIrnxLFWz4TOiOOEvg9/UfC9Eng0rATrIltVIvsouMv+5UpoKeljtuKHVsFSiLzM9m3hUux2fFm2ZGlRiKd2sQeRt1vdp2veEdwt07wr/SNblRvVLc86yn/h2XpTt2xb6sp9uvy6LsTjTrVHHPogP9XlbVrXpcofNulKPDVEdE5oUghRVkfb54TnaNrabNV9ixNXtd4F35Xn3OBUN3xL80deayz1Kr/XtuC7VYwmhbNlnh4O2ZJQtim3OQhsODyUhfjKE5GLQt5ALfnRV2oDQt/YQ5bnjZJJEkWLBcrFrlQU2J4676uRP2fln6pdPP4Ljq2PeMcqPWz4Sl3qWkEZ5iAei6XqlxNUMr5qsaDs9ImLLS+L71Dg6UhADcCm4fxaVvA8LbNvbYJSBeJaV6db+CIy0M6x1JixA1WPGjJ2aFRR6a7uarrUqCi0f1BRmRZrXnYqgoNGt48iScwJeoIOPnfE8fMSnb9Pdy2Q/H8ekWrp2w8H6ewYCtjOR2//fLwMR2v879UVgRJVXZW8w2fJn8uXiNyJHTfQU6I0z9Y7xBow4SBn33hRZhAFYnVhm61W2Ax72mQlv9unkp0nCHkgk6NcIidZrwcynuTpPc+ZDgWmJmfCfpJiVJM/v8hsfZUaLPhRdd5g2u1hug5Pffi2eHkJjvB2Ywt13nRscdxomNjSqWi42FKbcIzY4k6xZfjYogPJFWKLS28rtrzROEKp4ctL4wh1Rosjgd+Dyv8LI9TqCyJ/C/GZ8z0MbiB67pEwJGFA5i5hIWGMzH0SBYT5UhKTkMkyMYltMg9IBBIXy8DiLHbwUuyScDbFpQHiktdmK/C6ccnvGyQmzJcEJjs6jZvIj/6sJHlmSppev+MF9NqTeAFMIYkXOU9X4LX5grCEhElVAie6D64uAw+7uXhC8QmWtLjbfEOCtC5IVNHqkmghIZ2TyJMtJQg18hsS6DKUYTNVGNiHq/MIGYcbQRL7ckDAwYyEEdaD2kvqcayEeBBZJJwbHfPUaIJxgdr48sCwBCUh3OlUN1BpqxBHVMxQBbwWSTUZiaN6cMa/njSjyhaAAWVVruyNr5uRmiYkDrEVBuap6ozU8O7rhKyWNnri4lWwTbNLcFfs1SYP5AFYWndSxwupD9rSlfaWrgiTOu4wDCJa1fP9rHrkY0+ZVTeqI5pUEoNUo6dgVdRc9bSjsI+ex9gnK2FWHQR9bRMqG3a0merOaTNAqJzL9mN5AHfHTFsiTj63GmeVghWOcrgwKs1TIRur9itkQc6sdxDNi8ft+0Y1vuyVpRXRutYqxQtTSSTeQyVZvBTbbVbKpqUaKrYvWuyABC0aolZs3oBITxYeFo4iPQCqEq60FqA4V13SvWWBHFhMtiTHZSy7An9xpsGhIsuAWrZSAmcaOS4RV79hNTk/RQvtrLZ/Z2hTvDRHlXB8M1kmQEns9gUMXU8ToWp2bFhdUteAvLdmqMFrDzroWrwvxD49pLliM1ro+KCMgaNfVfxOo96EsBqW8fvzxg0Im1F88Fk55w9lz5xciv3PmpBh6lhmu/XvqMGsIYAzejxjoizFVsmGmMMDrzWHe353DvfCnjlcT/6vylzY3bzW9Hhx/ccL1xooBepaBhUDpkDtG0tzvVVWgqFYCUZkJeqwMlhOy56eHYfPabk9885o+fK6kjHocCY6hqeDRtekwx6PDjrRMQIdzjXp6L4tef0qxE0sCx62zFUIHWAV8taXF47VdqZ3aabbrGjM5YUzxluRCYLTvrsYAntECNwJgjEh0JP+ayHovDwbEgJvgmBUCMwBfCkEjpmvGhKCvldRr4UgCmZWENwmBOZmquDCXTR6GXiNSDBGKnOC4PUQ6HnkGpFgjBzlBEFji+2F04EJwZiJaqebfJwgeBORIDQgGPERsdZ5UAiSpPdtxS1AQA0ILs4TmBWNCkE3lThBMCAE+q3BqyEYcTro2V9dZ4HRDwS/XFW74pgvpg8PFD5N0aX7J+F/usXk7u7+sK9qchp56EqJs/PQBYf20ntZAJnZo42k1TxGvBlmoB9LcVC0kTO3XLR2P3xwr5tQpuazYs/rhj6qB0ko0zFyibe8WjB2pV68ddqMEZ2155AxYoxc4g1DoCeGU89850LgOVeEYIxc4g1D4A318OibX8YaMYNAT29r/2mrBTqtFhqrBc9IKto9X8cab7XQl2W8Jh72xEJr++yPWaBjsdDz3bwvhdiLA38HWif2+9v0ifnmR+9UbvhE/4zE8E7pruTi5ZLvy5v2ifmE1eeTaDSXdNdVk0sc19j5f12XdFc5SfW1npv0RWeBWa/8G74IhvEFnB5/9KZaoB5/WIjO/wM=&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g transform="translate(3,3)"><path d="M 40 39 L 671.76 40.97" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 677.76 40.99 L 669.75 44.97 L 671.76 40.97 L 669.78 36.97 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(11.5,30.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 18px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S<span style="font-size: 12.5px">5</span></div></div></foreignObject></g><path d="M 40 110 L 671.76 109.01" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 677.76 109 L 669.77 113.02 L 671.76 109.01 L 669.76 105.02 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(11.5,101.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 18px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S<span style="font-size: 12.5px">4</span></div></div></foreignObject></g><path d="M 40 190 L 671.76 189.01" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 677.76 189 L 669.77 193.02 L 671.76 189.01 L 669.76 185.02 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(146.5,607.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="396" height="34"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 398px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><span style="font-size: 30px">ZooKeeper 切主时事务的恢复</span></div></div></foreignObject></g><g transform="translate(47.5,427.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="576" height="172"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 576px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><ol><li><span>Server5 是leader，Server 1-4是follower</span></li><li>发生宕机或网络隔离等异常后，Server5不再是leader。Server3 被选择为Leader，Server 1-2 follow 他。在这之后，Server 1-3不会再接受原leader的任何指令。</li><li>在新leader切换之前，原leader收到了Server 3和Server4以及自身的ACK，形成法定人数(quorum)，所以Server 5可以发出commit消息。假设这时候Server5返回客户端本次请求处理成功了，即便集群发生了换主，新的集群内这个propasal也是有的(在Server 3上)。</li></ol></div></div></foreignObject></g><path d="M 40 261 L 671.76 260.01" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 677.76 260 L 669.77 264.02 L 671.76 260.01 L 669.76 256.02 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 40 331 L 671.76 330.01" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 677.76 330 L 669.77 334.02 L 671.76 330.01 L 669.76 326.02 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(11.5,321.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 18px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S<span style="font-size: 12.5px">1</span></div></div></foreignObject></g><g transform="translate(11.5,251.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 18px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S<span style="font-size: 12.5px">2</span></div></div></foreignObject></g><g transform="translate(11.5,181.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 18px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S<span style="font-size: 12.5px">3</span></div></div></foreignObject></g><path d="M 70 390 L 70 340.1" fill="none" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 333.35 L 74.5 342.35 L 70 340.1 L 65.5 342.35 Z" fill="#4c0099" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 330 L 70 280.1" fill="none" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 273.35 L 74.5 282.35 L 70 280.1 L 65.5 282.35 Z" fill="#4c0099" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 250 L 70 200.1" fill="none" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 193.35 L 74.5 202.35 L 70 200.1 L 65.5 202.35 Z" fill="#4c0099" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 170 L 70 120.1" fill="none" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 70 113.35 L 74.5 122.35 L 70 120.1 L 65.5 122.35 Z" fill="#4c0099" stroke="#4c0099" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 39 L 109.33 179.92" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 109.78 186.65 L 104.69 177.97 L 109.33 179.92 L 113.67 177.38 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 39 L 250.76 105.9" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 256.93 108.64 L 246.88 109.1 L 250.76 105.9 L 250.53 100.88 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 40 L 254.06 251.83" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 258.03 257.29 L 249.09 252.66 L 254.06 251.83 L 256.37 247.36 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 39 L 245.37 321.02" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 248.46 327.02 L 240.34 321.08 L 245.37 321.02 L 248.34 316.96 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 200 390 L 200 340.1" fill="none" stroke="#cc0000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 200 333.35 L 204.5 342.35 L 200 340.1 L 195.5 342.35 Z" fill="#cc0000" stroke="#cc0000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 200 320 L 200 270.1" fill="none" stroke="#cc0000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 200 263.35 L 204.5 272.35 L 200 270.1 L 195.5 272.35 Z" fill="#cc0000" stroke="#cc0000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(171.5,152.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="33" height="34"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font color="#ff3333" style="font-size: 30px">  2</font></div></div></foreignObject></g><path d="M 120 190 L 195.25 48.92" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 198.42 42.96 L 198.16 53.02 L 195.25 48.92 L 190.22 48.78 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 330 110 L 383.42 47.67" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 387.82 42.55 L 385.38 52.31 L 383.42 47.67 L 378.54 46.45 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 400 40 L 472.4 103.35" fill="none" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 477.48 107.79 L 467.74 105.25 L 472.4 103.35 L 473.67 98.48 Z" fill="#97d077" stroke="#97d077" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(411.5,2.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="33" height="34"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font color="#ff3333" style="font-size: 30px">  3</font></div></div></foreignObject></g><g transform="translate(41.5,2.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="17" height="34"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font color="#ff3333" style="font-size: 30px">1</font></div></div></foreignObject></g><g transform="translate(71.5,12.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="87" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Propose(1,1)</div></div></foreignObject></g><g transform="translate(171.5,12.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="77" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Accept(1,1)</div></div></foreignObject></g><g transform="translate(346.5,12.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="77" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Accept(1,1)</div></div></foreignObject></g><g transform="translate(481.5,84.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="52" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 15px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Commit</div></div></foreignObject></g></g></svg>