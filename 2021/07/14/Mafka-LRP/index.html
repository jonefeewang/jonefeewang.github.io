<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="IqPxX6jMzoqSIvuvpvuP9PCF7niBjR9EBY0UfP9MHEU"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="王军飞的博客"><title>Mafka长期发展规划(LRP) | 王军飞的随笔</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 7.1.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Mafka长期发展规划(LRP)</h1><a id="logo" href="/.">王军飞的随笔</a><p class="description">always be the best</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Mafka长期发展规划(LRP)</h1><div class="post-meta">2021-07-14<span> | </span><span class="category"><a href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.3k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 18</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" href="/2021/07/14/Mafka-LRP/#vcomment"><span class="valine-comment-count" data-xid="/2021/07/14/Mafka-LRP/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%EF%BC%8CMafka%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">1.</span> <span class="toc-text">云原生时代，Mafka的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E5%BC%8F%E6%9E%B6%E6%9E%84%E6%97%B6%E4%BB%A3"><span class="toc-number">1.1.</span> <span class="toc-text">单体式架构时代</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%97%B6%E4%BB%A3"><span class="toc-number">1.2.</span> <span class="toc-text">微服务架构时代</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mafka%E9%9D%A2%E4%B8%B4%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">1.3.</span> <span class="toc-text">Mafka面临的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E3%80%81%E6%89%A9%E5%B1%95%E8%83%BD%E5%8A%9B"><span class="toc-number">1.3.1.</span> <span class="toc-text">第一、扩展能力</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%85%A5k8s%EF%BC%8C%E6%8F%90%E5%8D%87%E9%9B%86%E7%BE%A4%E6%89%A9%E5%B1%95%E8%83%BD%E5%8A%9B"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">接入k8s，提升集群扩展能力</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4ZooKeeper%E4%BE%9D%E8%B5%96%EF%BC%8C%E6%8F%90%E5%8D%87broker%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">去除ZooKeeper依赖，提升broker的扩展性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96KRaft%E7%BB%84%E4%BB%B6%EF%BC%8C%E5%BD%A2%E6%88%90%E4%B8%80%E4%B8%AA%E4%BB%A5%E9%80%89%E4%B8%BB%E4%B8%BA%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E7%9A%84%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%EF%BC%8C%E4%BE%9BMafka%E5%86%85%E9%83%A8%E3%80%81%E5%85%AC%E5%8F%B8%E5%86%85%E9%83%A8%E5%85%B6%E4%BB%96%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">抽取KRaft组件，形成一个以选主为主要功能的基础组件，供Mafka内部、公司内部其他组件使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E3%80%81%E6%89%A9%E5%B1%95%E6%95%88%E7%8E%87"><span class="toc-number">1.3.2.</span> <span class="toc-text">第二、扩展效率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%86%E5%B1%82%E5%AD%98%E5%82%A8%EF%BC%8C%E6%8F%90%E5%8D%87%E5%AD%98%E9%87%8F%E5%88%86%E5%8C%BA%E7%9A%84%E8%BF%81%E7%A7%BB%E9%80%9F%E5%BA%A6"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">使用分层存储，提升存量分区的迁移速度</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82%E5%AF%B9Mafka%E6%9E%B6%E6%9E%84%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">2.</span> <span class="toc-text">业务需求对Mafka架构的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E9%9A%94%E7%A6%BB%E3%80%81hash%E7%94%9F%E4%BA%A7%E3%80%81%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%9E%8B%E5%AF%B9Mafka%E5%B8%A6%E6%9D%A5%E7%9A%84%E8%B5%84%E6%BA%90%E5%8E%8B%E5%8A%9B"><span class="toc-number">2.1.</span> <span class="toc-text">流量隔离、hash生产、消费模型对Mafka带来的资源压力</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E9%9A%94%E7%A6%BB%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%98%9F%E5%88%97%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97"><span class="toc-number">2.1.1.</span> <span class="toc-text">流量隔离带来的队列资源消耗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash%E7%94%9F%E4%BA%A7%E5%B8%A6%E6%9D%A5%E7%9A%84partition%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97"><span class="toc-number">2.1.2.</span> <span class="toc-text">hash生产带来的partition资源消耗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%9E%8B%E5%B8%A6%E6%9D%A5%E7%9A%84partition%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97"><span class="toc-number">2.1.3.</span> <span class="toc-text">消费模型带来的partition资源消耗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mafka4-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9D%A5%E8%A7%A3%E5%86%B3"><span class="toc-number">2.1.4.</span> <span class="toc-text">Mafka4 读写分离来解决</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97%E4%B8%9A%E5%8A%A1%E7%9A%84%E7%97%9B%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">实时计算业务的痛点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5Kafka-Stream-%E6%9D%A5%E6%9E%84%E5%BB%BA%E4%B8%80%E7%AB%99%E5%BC%8F%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.1.</span> <span class="toc-text">引入Kafka Stream 来构建一站式流式计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5Kafka-Stream-%E6%94%AF%E6%8C%81EDA-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">2.2.2.</span> <span class="toc-text">引入Kafka Stream 支持EDA(事件驱动架构)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BB%BA%E8%AE%AE%E5%8F%91%E5%B1%95%E8%B7%AF%E5%BE%84"><span class="toc-number">3.</span> <span class="toc-text">建议发展路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E4%BB%A5%E4%B8%8A%E5%88%86%E6%9E%90%EF%BC%8C%E6%80%BB%E7%BB%93MQ%E9%95%BF%E6%9C%9F%E8%A6%81%E8%A7%84%E5%88%92%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%82%B9"><span class="toc-number">3.0.1.</span> <span class="toc-text">综合以上分析，总结MQ长期要规划的项目有以下几点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%AE%AE%E5%8F%91%E5%B1%95%E8%B7%AF%E5%BE%84%E6%97%B6%E9%97%B4%E8%A1%A8"><span class="toc-number">3.0.2.</span> <span class="toc-text">建议发展路径时间表</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="云原生时代，Mafka的挑战"><a href="#云原生时代，Mafka的挑战" class="headerlink" title="云原生时代，Mafka的挑战"></a>云原生时代，Mafka的挑战</h1><h2 id="单体式架构时代"><a href="#单体式架构时代" class="headerlink" title="单体式架构时代"></a>单体式架构时代</h2><p> 大约在十几年前，我们在构建互联网应用时，使用的是下图这样的架构。</p>
<p> 外层提供一个API供客户端来调用，内层分为几个模块，每个模块负责一部分应用，如图所示，比如用户管理，购物⻋，商品目录，订单管理，库存，运输。这是一个典型的单体架构应用，所有的模块和API层都在一个应用里，客户端在HTML里调用服务端API来完成展示和交互，服务端访问数据库来完成一系列业务逻辑。开发、测试、部署，问题查找，扩容，都很方便快捷，尤其在初创型公司里，一个或几个人快速搭建一个应用原型，单体式架构非常高效。</p>
<p>随着业务需求的迭代，系统功能的增加，单体式应用逐渐遇到一些开发上的问题：</p>
<ol>
<li>系统随着业务需求的增加变得越来越复杂，没有一个人能完全了解整个系统。</li>
<li>每一次新的需求迭代开发，所需的开发时间越来越⻓，而且越来越容易出错误。</li>
<li>一个小的变更需要将整个系统重新部署一次，变更的代价和⻛险比较大。</li>
<li>一个小组件的问题或bug，会让整个系统变得不可用。</li>
<li>新的技术和框架很难被应用到项目中去</li>
</ol>
<p>直到最后，不得不重新编写整个系统。这个时候，微服务架构诞生！<br> <img src="/2021/07/14/Mafka-LRP/monothnic.svg"></p>
<h2 id="微服务架构时代"><a href="#微服务架构时代" class="headerlink" title="微服务架构时代"></a>微服务架构时代</h2><p>在微服务架构下，整个系统被拆分为若干个独立的服务，他们有各自的代码库，独立演进和迭代，如下图所示:</p>
<p> <img src="/2021/07/14/Mafka-LRP/mordern_apps.svg"></p>
<ol>
<li>整个系统被拆分为若干个小的服务子系统，便于理解和规划</li>
<li>每个小服务都是小单元，小项目，包含自己的数据，repo，代码和依赖，便于独立开发和迭代</li>
<li>每个服务都部署在一个容器内，由容器管理器来统一编排</li>
<li>没有统一的一个关系数据库，都有各自的数据库或存储，以及分布式缓存</li>
<li>使用统一的网关来做一些横向的策略应用，比如鉴权，分控等。</li>
</ol>
<p>最重要的是，现代的微服务架构充分使用了云的基础设施，实现 <strong>高扩展性</strong> ， <strong>高可用性</strong> ，以及 <strong>高韧性</strong> ，我们统一称这类微服务或应用为 <strong>云原生应用</strong> (cloud native application)。</p>
<p>面对市场形势多变的特点，以及互联网业务发展迅猛的形势，企业必须对业务进行快速的开发和迭代，以抢占瞬息万变的市场机会。云原生应用的最大特点就是快速拥抱变化，他们可以在几分钟内快速的扩容，缩容，迁移，销毁，以应对业务和市场快速的需求变化。这对应用和服务的周边配套设施，如构建，部署，配置，监控，PaaS，IaaS等支持服务提出了更高的要求.</p>
<h2 id="Mafka面临的挑战"><a href="#Mafka面临的挑战" class="headerlink" title="Mafka面临的挑战"></a>Mafka面临的挑战</h2><p>Mafka作为支持云原生的PaaS服务之一，面临着以下三个方面的挑战</p>
<h3 id="第一、扩展能力"><a href="#第一、扩展能力" class="headerlink" title="第一、扩展能力"></a>第一、扩展能力</h3><h4 id="接入k8s，提升集群扩展能力"><a href="#接入k8s，提升集群扩展能力" class="headerlink" title="接入k8s，提升集群扩展能力"></a>接入k8s，提升集群扩展能力</h4><p>以下是Mafka的系统架构图</p>
<p><img src="/2021/07/14/Mafka-LRP/mafka_arch.svg"></p>
<p>整体架构上，要匹配云原生服务的快速扩缩容，Mafka的几个核心模块首先必须具备横向扩展能力</p>
<table>
<thead>
<tr>
<th>模块</th>
<th>简介</th>
<th>服务类型</th>
<th>服务架构</th>
<th>容器+弹性伸缩接入情况</th>
<th>扩缩容能力</th>
</tr>
</thead>
<tbody><tr>
<td>Castle</td>
<td>Mafka调度器</td>
<td>RPC服务 (MNS invoker + Netty自有协议)</td>
<td>本机可重建Cache + KV存储 + ZK选主</td>
<td>已接入容器</td>
<td>已接入弹性伸缩</td>
</tr>
<tr>
<td>PushServer</td>
<td>Mafka Push代消费</td>
<td>RPC服务(Castle服务发现+Netty自有协议)</td>
<td>本机可重建Cache + KV存储 + ZK选主/简单通知</td>
<td>已接入容器</td>
<td>具备横向扩容能力</td>
</tr>
<tr>
<td>DelayServer</td>
<td>Mafka 延迟队列</td>
<td>RPC服务(Octo+Mtthrift)</td>
<td>本机可重建Cache + KV存储 + ZK选主</td>
<td>已接入容器</td>
<td>已接入弹性伸缩</td>
</tr>
<tr>
<td>Broker</td>
<td>Mafka 消息Broker</td>
<td>基于文件的分布式系统</td>
<td>本机磁盘存储 + ZK选主/元信息存储</td>
<td>接入容器中</td>
<td>具备横向扩容能力</td>
</tr>
</tbody></table>
<p>如图，三个RPC服务都已经接入了容器，并且接入了hulk弹性伸缩，已经具备了横向扩缩容的能力。<br>Mafka Broker 正在接入容器过程中，现阶段主要靠虚机来做扩缩容，目前还未接入弹性。<br>如消息队列业界调研所述，Kafka、Pulsar、RocketMQ都在使用容器以及k8s技术来增强自身的扩展性。<br>三家产品容器化技术对比：</p>
<table>
<thead>
<tr>
<th>产品</th>
<th>扩容组件</th>
<th>容器化技术</th>
</tr>
</thead>
<tbody><tr>
<td>Kafka</td>
<td>Confluent Cloud for k8s</td>
<td>k8s operator</td>
</tr>
<tr>
<td>Pulsar</td>
<td>StreamNative Helm</td>
<td>k8s operator</td>
</tr>
<tr>
<td>RocketMQ</td>
<td>阿里云消息队列RocketMQ版</td>
<td>k8s operator</td>
</tr>
</tbody></table>
<p>Kafka官方公司Confluent Cloud For k8s的服务架构:</p>
<blockquote>
<p>*下图引用自confluent engineering blog</p>
</blockquote>
<p><img src="/2021/07/14/Mafka-LRP/confluent_platform.png"></p>
<p>以Kafka为例，Confluent使用自研的k8s operator为集群扩容或替换。<br><img src="/2021/07/14/Mafka-LRP/confluent_op.svg"></p>
<p>如上图所示，Confluent Cloud可以动态扩容集群的节点，磁盘、CPU、M EM等，甚至可以做到以编程的方式来自动编排。<br>当某台容器宕机后，他可以自动侦测到，并自动添加新的节点到集群内，填补宕机节点的空缺。<br>所以，要提升Mafka的扩展能力， <strong>第一步要做的就是接入容器化，增加k8s operator的使用，增强Mafka broker的横向扩展能力</strong> 。</p>
<h4 id="去除ZooKeeper依赖，提升broker的扩展性"><a href="#去除ZooKeeper依赖，提升broker的扩展性" class="headerlink" title="去除ZooKeeper依赖，提升broker的扩展性"></a>去除ZooKeeper依赖，提升broker的扩展性</h4><p>Kafka一开始设计的时候，依靠zookeeper来解决系统的一致性问题，比如集群controller的选主，partition leader的选主，同时还保存了集群的metadata信息。<br>随着集群内topic数量，分区数量的增⻓，metadat数据数量也跟着增⻓，但是kafka集群在启动以后，或集群发生重新选主时，集群的controller需要全量拉取一次zookeeper上的metadata数据，所以这个数据越<br>大，拉取的耗时也会越⻓，直接影响了集群controller的可用性，最终必须限制metadata数据的大小， <strong>这就限制了Kafka集群的横向扩展能力</strong> 。</p>
<p><img src="/2021/07/14/Mafka-LRP/kafka_zk.svg"></p>
<p>Kafka官方为了解决这个问题，引入了一个新的提案KIP-500，去除Kafka对zookeeper的依赖<br><img src="/2021/07/14/Mafka-LRP/kafka_quorum.svg"></p>
<p>如上图，每个broker内都有一个副本Log文件，它的内容就是集群的全量的metadata数据。同时集群内stand by 的c ontroller会形成一个Raft协议集群，依靠自身来做一致性选举。<br>当发生controller选主的时候，Kafka集群不再需要从zookeeper 读取全量的metadata数据，这样就加快了controller的启动过程，即便集群内metadata数据再大，也不会有影响， <strong>①直接提升了broker的扩展性</strong> 。<br>去除z ookeeper除了提升broker的扩展性外， <strong>②还能降低组件的复杂度</strong> ，两个组件减少为一个组，演进和迭代能减轻很大的负担； <strong>③同时还能减少部署和运维</strong> ，部署kafka集群时不需要再部署一个zookeeper集群，<br>也不需要单独维护zookeeper的稳定性。<br>除此之外， <strong>④还能解决Mafka 容灾 2 .0特殊情况下的集群脑裂问题:</strong> 如下图</p>
<p><img src="/2021/07/14/Mafka-LRP/disaster_recover.svg"></p>
<p>当机房间发生断网时，如果形成一个孤岛机房，而且集群的主(Controller)又恰好在孤岛机房内，孤岛机房外的集群节点会选举一个新的主(Controller)，这时当网络恢复后会，集群内会出现两个Controller，整个集<br>群会发生脑裂。</p>
<p><img src="/2021/07/14/Mafka-LRP/dual_idc_deploy.svg"></p>
<p>如果引入Kafka KIP-500去除Zookeeper PR后，一致性内嵌在Broker内部，可以通过配置小Quorum大小来解除孤岛机房内的主(Controller)，避免形成脑裂问题。</p>
<h4 id="抽取KRaft组件，形成一个以选主为主要功能的基础组件，供Mafka内部、公司内部其他组件使用"><a href="#抽取KRaft组件，形成一个以选主为主要功能的基础组件，供Mafka内部、公司内部其他组件使用" class="headerlink" title="抽取KRaft组件，形成一个以选主为主要功能的基础组件，供Mafka内部、公司内部其他组件使用"></a>抽取KRaft组件，形成一个以选主为主要功能的基础组件，供Mafka内部、公司内部其他组件使用</h4><h3 id="第二、扩展效率"><a href="#第二、扩展效率" class="headerlink" title="第二、扩展效率"></a>第二、扩展效率</h3><h4 id="使用分层存储，提升存量分区的迁移速度"><a href="#使用分层存储，提升存量分区的迁移速度" class="headerlink" title="使用分层存储，提升存量分区的迁移速度"></a>使用分层存储，提升存量分区的迁移速度</h4><p>在第一部分提到在云原生时代，云原生应用除了需要很高的横向扩展能力外，更重要的是要具备快速的扩展效率。<br>要提升扩展效率，除了接入容器化、k8s operator和弹性来提升自动化能力外，还要增强broker的扩容速度。<br>如Mafka Broker全链路弹性伸缩演进策略所述，对于单个主题或多个主题扩容时都有比较快速的方法，但是对集群整体扩容时，存量数据的迁移速度比较慢，耗时⻓，如下图所示:</p>
<p><img src="/2021/07/14/Mafka-LRP/mv_partition.svg"></p>
<p>使用分层存储后，单个分片数据量变小，不仅能节约磁盘空间容量，还能降低节点磁盘读压力，最重要的是加快了分区数据的迁移速度，增强集群的扩容效率。</p>
<p><img src="/2021/07/14/Mafka-LRP/tired_store_mvp.svg"></p>
<p>不仅如此，Kafka官方依靠分层存储实现了Kafka <strong>无限存储</strong> 能力，架构如下图:</p>
<blockquote>
<p>*下图引用自confluent engineering blog</p>
</blockquote>
<p><img src="/2021/07/14/Mafka-LRP/infinet_storage.png"></p>
<h1 id="业务需求对Mafka架构的挑战"><a href="#业务需求对Mafka架构的挑战" class="headerlink" title="业务需求对Mafka架构的挑战"></a>业务需求对Mafka架构的挑战</h1><h2 id="流量隔离、hash生产、消费模型对Mafka带来的资源压力"><a href="#流量隔离、hash生产、消费模型对Mafka带来的资源压力" class="headerlink" title="流量隔离、hash生产、消费模型对Mafka带来的资源压力"></a>流量隔离、hash生产、消费模型对Mafka带来的资源压力</h2><h3 id="流量隔离带来的队列资源消耗"><a href="#流量隔离带来的队列资源消耗" class="headerlink" title="流量隔离带来的队列资源消耗"></a>流量隔离带来的队列资源消耗</h3><p>由于业务的发展的需求，mafka支持多重流量隔离方案，比如泳道，方便了QA人员同时开展多条测试链路，每个泳道的消费者只消费本泳道生产者生产的消息<br>，如果下游没有泳道消费者，⻣干的消费者需要把泳道的消息也消费掉，如下图所示，<br><img src="/2021/07/14/Mafka-LRP/mafka_swl.svg"><br>类似的流量隔离方案，还有环境隔离，比如test/dev/prod/stage各类测试和生产环境；Set化隔离，比如North、East、West、South等各种Set。Mafka在满足这些流量隔离时，采用的是队列模拟，<br>比如对于业务的某个队列，在环境隔离时，每个环境用一个队列去模拟，当多种流量隔离发生交叉时，prod环境下的Set，test环境下的泳道，又会产生多个底层队列。再加上其他的特性，比如死信，<br>优先级队列等，这些功能都是通过底层队列来模拟的 <strong>，再次发生排列组合以后，队列资源耗费的比较快</strong> 。</p>
<h3 id="hash生产带来的partition资源消耗"><a href="#hash生产带来的partition资源消耗" class="headerlink" title="hash生产带来的partition资源消耗"></a>hash生产带来的partition资源消耗</h3><p>有些业务在向Mafka生产消息时，需要将特定类的消息放到一起，以便消费的时候，同一类消息由相同的消费者来消费<br><img src="/2021/07/14/Mafka-LRP/hash_produce.svg"><br>如上所示，业务在向订单队列生产消息时，希望某一类的订单集中放到一起，然后由同一个消费者来消费。Mafka在底层是通过分区来实现的，每一类的消息都放到同一个分区上，<br>在业务消费的时候，这个分区的所有消息统一由某一个消费者来消费。这样就带来一个问题， <strong>当业务hash的结果数据集类型比较多的时候，Mafka的paritition资源消耗的比较快。</strong></p>
<h3 id="消费模型带来的partition资源消耗"><a href="#消费模型带来的partition资源消耗" class="headerlink" title="消费模型带来的partition资源消耗"></a>消费模型带来的partition资源消耗</h3><p>Mafka的消息队列在被业务客户端消费时，受限于Mafka的消费模型，一个队列的一个partition只能被一个消费者消费<br><img src="/2021/07/14/Mafka-LRP/common_consume.svg"></p>
<p>如上图所示，队列A有 3 个partition 分别是P0、P1、P2，业务有3个消费者，A、B、C分别负责消费P0、P1、P2。当消费逻辑耗时比较高，队列产生消息积压时，业务会要求加入多个消费者，这时Mafka就必须为业务扩容partition，增加更多的分区，以便新创建的消费者能消费到消息。 <strong>在这种场景下，Mafka partition资源的消耗并不是来自于队列流量的增加，而仅仅是业务消费者数量的增加，消费者数量和partition数量有紧密的耦合关系，导致partition资源的消耗</strong> 。</p>
<h3 id="Mafka4-读写分离来解决"><a href="#Mafka4-读写分离来解决" class="headerlink" title="Mafka4 读写分离来解决"></a>Mafka4 读写分离来解决</h3><p>以上所说的三个问题，不管是队列资源的消耗，还是partition资源的消耗，都会让整个集群的partition数量的增⻓，从而消耗整个集群的容量。最明显的问题，就是整个集群的partition数量增加到一定程度后，用户<br>的发送耗时会增加，集群吞吐量会降低。<br>对于这个问题，业界和Kafka社区并没有现成的策略和办法来参考。经过我们的测试和调研，提出了Mafka 4解决方案，通过队列合并来，分离读写节点来解决这个问题。<br><img src="/2021/07/14/Mafka-LRP/mafka4.svg"></p>
<p>如上图所示，通过进入物理分区，虚拟分区，以及读写节点的概念，来重建整个Kafka 数据和存储模型。<br>这个方案不仅能有效的解决了上述所说的三个问题，还可以满足业务⻓期的发展需要，提升架构扩展性和效率：</p>
<ol>
<li>合并各类流量隔离队列，来减少物理机队队列数量的膨胀，减少队列资源消耗。能让架构更灵活高效，解决将来业务在线上的各种流量隔离需求。</li>
<li>解耦了partition数量和消费者数量之间的紧耦合关系，引入虚拟分区来解决这个问题。最终让业务对partition概念透明，业务有新的消费者上来后，分区会自动扩容，分配消息给新的消费者。</li>
<li>可以合并小流量队列到一个物理队列上，也可以合并队列多个分区到一个物理分区上，缩减集群的分区和队列数量，大幅提升原有集群的容量。</li>
</ol>
<h2 id="实时计算业务的痛点"><a href="#实时计算业务的痛点" class="headerlink" title="实时计算业务的痛点"></a>实时计算业务的痛点</h2><h3 id="引入Kafka-Stream-来构建一站式流式计算"><a href="#引入Kafka-Stream-来构建一站式流式计算" class="headerlink" title="引入Kafka Stream 来构建一站式流式计算"></a>引入Kafka Stream 来构建一站式流式计算</h3><p>随着业务的发展，实时计算技术近年来逐渐成熟起来，比如storm/flink一类实时计算框架，我们公司大数据业务也有相应的服务。<br>通常情况，在线业务在使用实时计算时采用的如下的架构：</p>
<p><img src="/2021/07/14/Mafka-LRP/mafka_storm.svg"></p>
<p>业务先将数据发送到Mafka，然后再storm、f link平台上消费Mafka的消息，来做实时计算，计算完成后将数据再推送回Mafka，供在线业务是消费和展示。<br><strong>①这种架构需要先将从Mafka搬迁到实时计算平台上，多了一次传输，浪费了一些时间和效率。<br>②而且在问题排查方面，storm和f link非常不友好，</strong> 因为业务需要将自己的代码上传到这两个平台上，程序实际是在远程平台上执行的，而远程平台又是大集群、多用户，<br>调查问题、调试程序非常麻烦，效率低下。<br><strong>③另外，storm和f link自身有一定的复杂度，入⻔成本也比较高，对于一些只需要做一个简单窗口聚合计算的用户来说比较重，需要花时间和精力先学习。</strong></p>
<p>实际上Kafka官方本身就支持轻量的实时流式计算服务，叫做Kafka Stream。K afka Stream是集成在Kafka内部的轻量流式计算库，他跟Kafka集成在一起。<br>不同于Flink和S torm，K afka Stream不是一个平台，不需要用户将代码打包上传到平台上，他只是一个简单的lib库，用户像写应用程序一样写流式计算服务，<br>编译打包成功后，运行在用户自己的机器上。<br>下图是一个Mafka集成Kafka Stream后的部署架构图：</p>
<p><img src="/2021/07/14/Mafka-LRP/kafka_stream.svg"></p>
<p>业务app后端服务将在线数据写入Mafka，然后通过自有的实时计算服务消费这些数据，计算完成后再把计算结果写回Mafka，供a pp后端服务来使用。<br>业务自有的实时计算服务是自己的服务，像普通的后端服务一样构建和部署。在实时流式计算过程中还可以使用到大数据存储Blade，计算结果也可以存储在Cellar<br>中供业务app后端服务来存取。</p>
<p>Kafka Stream目前使用也很广泛，大厂如twitter就将自己首⻚的推荐引擎也搬迁到了Kafka stream上，架构如下图：</p>
<blockquote>
<p>*下图引用自twitter engineering blog</p>
</blockquote>
<p><img src="/2021/07/14/Mafka-LRP/twitter_kafka_stream.png"></p>
<p>总结起来，引入Kafka Stream的优势:</p>
<ol>
<li>实时流式计算可以在Mafka一站式解决，减少数据的搬运，降低整个实时计算链路的延迟</li>
<li>KafkaStreams是本地lib库，开发、调试方便</li>
</ol>
<ul>
<li>意味着RD可以在本地开发和测试自己的Kafka Stream流式任务，Strom/Flink等需要将服务部署到集群上，开发者很难了解框架的具体运行方式，从而使得调试成本高，并且使用受限.</li>
</ul>
<ol start="2">
<li>Kafka Stream非常的轻量级，可以应用到微服务、IOT等实时流式计算以及EDA架构场景下:</li>
</ol>
<ul>
<li>Strom/Flink都是计算框架，需要部署一个集群，将自己的流式作业上传到集群处理，kafaStreams是l ib库，业务程序集成后就可以可开始流式计算。</li>
</ul>
<ol start="3">
<li>接入方便，使用成本低</li>
</ol>
<ul>
<li>Mafka在公司内广泛使用，业务已经将消息和数据发往了Mafka，如果Mafka推出s tream流式计算，业务只要升级Mafka client版本，既可拥有流式计算能力，相对业务来说，使用流式计算技术的成本非常<br>低。</li>
</ul>
<h3 id="引入Kafka-Stream-支持EDA-事件驱动架构"><a href="#引入Kafka-Stream-支持EDA-事件驱动架构" class="headerlink" title="引入Kafka Stream 支持EDA(事件驱动架构)"></a>引入Kafka Stream 支持EDA(事件驱动架构)</h3><p>事件驱动架构(Event Driven Architecture)是近两年流行起来的新的架构方式，相比传统的请求驱动架构(Request Driven Architecture)，他有以下优势:</p>
<ol>
<li>模块之间松散耦合</li>
</ol>
<ul>
<li>由于生产者和消费者两个模块通过消息队列解耦，消息生产者不需要知道消费者是谁，在不在线，可以一直生产。后续业务需求增加新的功能，不影响原有系统。</li>
</ul>
<ol start="2">
<li>异步</li>
</ol>
<ul>
<li>生产者不需要等待消费者处理，只需要发送完消息即可返回，实现生产和消费的异步结构。</li>
</ul>
<ol start="3">
<li>可扩展性强</li>
</ol>
<ul>
<li>由于模块之间松散的耦合，各自可以独立扩展，互不影响。</li>
</ul>
<ol start="4">
<li>可恢复</li>
</ol>
<ul>
<li>因为模块之间通过消息来通知和驱动，消息又可以回放，因此当消费者宕机后，可以重新回放之前的消息来恢复系统状态。</li>
</ul>
<p>Kafka Stream对 EDA 架构具有天然的支持优势，如KTable，KSQL，各类Material View等。<br>如下图，依靠事件传输来驱动整个业务的完成：</p>
<p><img src="/2021/07/14/Mafka-LRP/event_driven.svg"></p>
<ol>
<li>整个系统包含订单系统、发货系统和客户系统，三个系统各自有自己的数据库，系统之间通信使用Kafka消息。</li>
<li>用户提交完订单后，发送订单创建消息</li>
<li>发货系统消费订单信息，提供发货支持</li>
<li>用户系统将用户资料变更发送给Kafka</li>
<li>发货系统消费用户变更资料，构建为全量的本地用户资料，存储在Ktable里</li>
<li>发货系统本身是一个流式运算系统</li>
</ol>
<p>同时还可以使用KSQL 产生各类预定义视图，如下图示，使用CQRS模式增强读写操作的扩展性:</p>
<p><img src="/2021/07/14/Mafka-LRP/cqrs.svg"></p>
<ol>
<li>创建订单后，发送消息到Kafka</li>
<li>在查询面，可以使用KSQL的功能，创建多种(Materialised View)实体图，因为Kafka的Pub/Sub模型，实体图的个数可以很多。</li>
</ol>
<h1 id="建议发展路径"><a href="#建议发展路径" class="headerlink" title="建议发展路径"></a>建议发展路径</h1><h3 id="综合以上分析，总结MQ长期要规划的项目有以下几点"><a href="#综合以上分析，总结MQ长期要规划的项目有以下几点" class="headerlink" title="综合以上分析，总结MQ长期要规划的项目有以下几点"></a>综合以上分析，总结MQ长期要规划的项目有以下几点</h3><table>
<thead>
<tr>
<th>编号</th>
<th>项目</th>
<th>收益</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>接入k8s，提升Mafka集群的扩展能力</td>
<td>接入容器化，增加k8s operator的使用，增强Mafka broker的横向扩展能力。</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>去除ZooKeeper依赖，提升broker的扩展性</td>
<td><ol><li>直接提升了broker的扩展性。</li> <li>降低组件的复杂度</li><li>减少部署和运维</li><li>解决Mafka 容灾2.0特殊情况下的集群脑裂问题</li></ol></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>使用分层存储，提升存量分区的迁移速度</td>
<td>提升Mafka Broker集群的存量分片迁移能力</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>建设Mafka 4 读写分离集群</td>
<td><ol><li>支持业务更多类型的流量隔离需求</li><li>解耦分片和消费者数量紧耦合关系，降低集群分片资源消耗速度</li><li>提升集群的整体吞吐量</li><li>合并小流量队列，减少集群分片的消耗，提升集群容量</li></ol></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>引入Kafka Stream 来构建一站式流式计算</td>
<td><ol><li>实时流式计算可以在Mafka一站式解决，减少数据的搬运，降低整个实时计算链路的延迟</li><li>KafkaStreams是本地lib库，开发、调试方便</li><li>Kafka Stream非常的轻量级，可以应用到微服务、IOT等实时流式计算</li><li>接入方便，使用成本低</li></ol></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>引入Kafka Stream 支持EDA(事件驱动架构)</td>
<td><ol><li>对业务的EDA架构应用提供完整的支持</li><li>降低业务应用架构的耦合度</li></ol></td>
<td></td>
</tr>
</tbody></table>
<h3 id="建议发展路径时间表"><a href="#建议发展路径时间表" class="headerlink" title="建议发展路径时间表"></a>建议发展路径时间表</h3><p>略</p>
<p>参考:</p>
<ol>
<li>Making Apache Kafka Serverless: Lessons From Confluent Cloud</li>
<li>Kafka，confluent，The Cloud-Native Evolution of Apache Kafka on Kubernetes</li>
<li>Kafka，confluent，Making Apache Kafka Serverless: Lessons From Confluent Cloud</li>
<li>Infinite Storage in Confluent Platform</li>
</ol>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>Mafka长期发展规划(LRP)</p><p><span>文章作者：</span>王军飞 jonefeewang@outlook.com</p><p><span>发布时间：</span>2021-07-14</p><p><span>最后更新：</span>2024-03-24</p><p><span>原始链接：</span><a href="/2021/07/14/Mafka-LRP/">https://www.wangjunfei.com/2021/07/14/Mafka-LRP/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://www.wangjunfei.com/2021/07/14/Mafka-LRP/"></i></span></p><p><span>版权声明：</span>原创文章转载请注明出处</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://www.wangjunfei.com/2021/07/14/Mafka-LRP/" data-id="clu6b2h900004hzs65xczeecx" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMklEQVR42u3aQXLbMAwFUN//0uq2M0mkD4BNR+TjKmMrEp8WMAjg84nX9df6+nl+/f01yX+NFgYGxmsZ1+26f2SCSbaYPPenazAwMM5hJJu4v3XCu//k/m4Pe8bAwMAoBsreNb1QjoGBgZGHxSRc3h+G/9vvBgYGxksYecKXlMzywJ0fnpedxTEwMF7IyKvuv//3P+lvYGBgvIpxFVd+h2q4vAYLAwNjb0Ye4CYH17z0lqd9GBgY5zB6w1t5+pjfvzd8NppBw8DAeAmjN+JQDb6T8lnenMDAwNiVUT2mTgLugvedpIYYGBjbMXqZVa/cNn8pUdKJgYGxHaM3ZtE7avZGviI2BgbGAYz5MTV5fC8QR0NmGBgYBzDyhuJk073Gw4JyGwYGxkaMtelaEiiTBDQa1MDAwDiYkQ9MNA+fxaJec8wCAwNjC0bvdtGoVut4nBxov0kNMTAwDmD02gBJKjlpVX6qt8DAwNiOUb1RNWjmLyJviP7Iw8DAOIaRf1vdaK+1WTgeY2BgHMDIMdWCfrklGT/xoT2AgYGxHaNaVsuvSUppkyIdBgbGaYykiJaP5ucH3XmDAQMDY1fGVVzVZmf+UvIg+5DbYmBgbMeYhLkcWd1Kb7gfAwNjb8aqIFttfE6CdfnXAwMDYwvGpKA2KZOtKsBhYGBg9AYy1g5ePDwFAwMDoziUn28xfwUPpToMDIwDGKvG5avJXzWJxMDAOJNRLaL1jqb5qOu8tYCBgbER4w9nhLwqHvzpEwAAAABJRU5ErkJggg==">分享</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kafka/" rel="tag">kafka</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rocketmq/" rel="tag">rocketmq</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a></li></ul></div><div class="post-nav"><a class="pre" href="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/">Mafka全链路弹性伸缩演进策略</a><a class="next" href="/2021/04/15/%E7%BE%8E%E5%9B%A2%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97Mafka/">美团消息队列Mafka</a></div><div class="nofancybox" id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'true' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'FNjCNRwQqC3sTPP04DfRFIk9-gzGzoHsz',
  appKey:'LzCq5t6a6RTkwXQVr8xLk0yj',
  serverURLs:'',
  placeholder:'请理性评论',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://www.wangjunfei.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.png"/></a><p>Always be the best</p><a class="info-icon" href="mailto:jonefeewang@outlook.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/jonefeewang" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/">分布式技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E4%BA%A4%E6%B5%81%E6%B2%9F%E9%80%9A/">务虚-交流沟通</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/">务虚-管理方法论</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/">磁盘读写优化</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Apache-pulsar-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-kafka-RocketMQ/" style="font-size: 15px;">Apache pulsar 消息队列 kafka RocketMQ</a> <a href="/tags/kafka-raft-kraft-zookeeper/" style="font-size: 15px;">kafka raft kraft zookeeper</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/pulsar/" style="font-size: 15px;">pulsar</a> <a href="/tags/Apache-Pulsar/" style="font-size: 15px;">Apache Pulsar</a> <a href="/tags/Apache-Bookkeeper/" style="font-size: 15px;">Apache Bookkeeper</a> <a href="/tags/Apache-Kafka/" style="font-size: 15px;">Apache Kafka</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">务虚-管理方法论</a> <a href="/tags/%E5%8D%8E%E4%B8%BA/" style="font-size: 15px;">华为</a> <a href="/tags/%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">管理方法论</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 15px;">管理</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E9%A2%86%E5%AF%BC%E6%A2%AF%E9%98%9F/" style="font-size: 15px;">务虚-领导梯队</a> <a href="/tags/%E5%8A%A1%E8%99%9A/" style="font-size: 15px;">务虚</a> <a href="/tags/%E5%8D%8F%E4%BD%9C/" style="font-size: 15px;">协作</a> <a href="/tags/%E8%BD%AF%E7%B4%A0%E8%B4%A8/" style="font-size: 15px;">软素质</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">分布式技术</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/consensus-algorithm/" style="font-size: 15px;">consensus algorithm</a> <a href="/tags/zab/" style="font-size: 15px;">zab</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%AE%AE/" style="font-size: 15px;">分布式协议</a> <a href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" style="font-size: 15px;">一致性算法</a> <a href="/tags/%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%BD%AF%E7%B4%A0%E8%B4%A8%E6%8F%90%E5%8D%87/" style="font-size: 15px;">方法论 软素质提升</a> <a href="/tags/kafka-netty-%E6%97%B6%E9%97%B4%E8%BD%AE/" style="font-size: 15px;">kafka netty 时间轮</a> <a href="/tags/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/" style="font-size: 15px;">磁盘读写优化</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 15px;">云原生</a> <a href="/tags/%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">流式计算</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/12/25/Apache-Pulsar%E7%9A%84%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">Apache Pulsar的存储模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/">Apache pulsar对zookeeper的依赖和去除分析(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/">Apache pulsar对zookeeper的依赖和去除分析(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/10/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/">时间轮算法分析和应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/01/Kafka%E5%8E%BBZookeeper%E6%8F%AD%E7%A7%98/">Kafka去Zookeeper揭秘</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/15/PRFAQ%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/">「转」PRFAQ编写规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/13/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E6%B3%95%E8%AE%BA%E6%B1%87%E9%9B%86/">「转」几种常见的工作方法论汇集</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/08/14/%E8%BD%AF%E7%B4%A0%E8%B4%A8%E8%9E%BA%E6%97%8B%E4%B8%8A%E5%8D%87/">软素质螺旋上升</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/">Mafka全链路弹性伸缩演进策略</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/07/14/Mafka-LRP/">Mafka长期发展规划(LRP)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">王军飞的随笔.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>