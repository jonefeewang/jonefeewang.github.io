<!DOCTYPE html><html lang="en-US"><head><meta name="google-site-verification" content="IqPxX6jMzoqSIvuvpvuP9PCF7niBjR9EBY0UfP9MHEU"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Rex Wangs blog"><title>Mafka全链路弹性伸缩演进策略 | Rex Wang</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Mafka全链路弹性伸缩演进策略</h1><a id="logo" href="/.">Rex Wang</a><p class="description">always be the best</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Mafka全链路弹性伸缩演进策略</h1><div class="post-meta">2021-07-22<span> | </span><span class="category"><a href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 3.9k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 13</span><span class="post-meta-item-text"> Minutes</span></span></span></div><a class="disqus-comment-count" href="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/#vcomment"><span class="valine-comment-count" data-xid="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/"></span><span> Comment</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%9A%E7%95%8C%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E8%B0%83%E7%A0%94"><span class="toc-number">1.</span> <span class="toc-text">业界全链路弹性伸缩调研</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-Kafka%E7%9A%84%E5%BF%AB%E9%80%9F%E6%89%A9%E7%BC%A9%E5%AE%B9%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">Apache Kafka的快速扩缩容方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E7%89%B9%E7%82%B9-%E9%87%8D%E5%AD%98%E5%82%A8%EF%BC%8C%E8%BD%BB%E8%AE%A1%E7%AE%97"><span class="toc-number">1.1.1.</span> <span class="toc-text">架构特点-重存储，轻计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A%E3%80%81%E7%AC%AC%E4%B8%80%E7%A7%8D%E3%80%81%E6%89%A9%E5%AE%B9%E5%88%86%E7%89%87-%E9%9B%86%E7%BE%A4%E5%86%85%E6%89%A9%E5%AE%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">A、第一种、扩容分片(集群内扩容)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B%E3%80%81%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%8C%E6%89%A9%E5%AE%B9%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%EF%BC%8C%E6%89%BF%E6%8B%85%E6%96%B0%E7%9A%84%E5%88%86%E7%89%87"><span class="toc-number">1.1.3.</span> <span class="toc-text">B、第二种，扩容集群节点，承担新的分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C%E3%80%81%E7%AC%AC%E4%B8%89%E7%A7%8D%EF%BC%8C%E6%89%A9%E5%AE%B9%E9%9B%86%E7%BE%A4%EF%BC%8C%E8%BF%81%E7%A7%BB%E5%AD%98%E9%87%8F%E5%88%86%E7%89%87"><span class="toc-number">1.1.4.</span> <span class="toc-text">C、第三种，扩容集群，迁移存量分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D%E3%80%81%E7%AC%AC%E5%9B%9B%E7%A7%8D%EF%BC%8C%E5%AD%98%E5%82%A8%E4%BB%BB%E5%8A%A1%E4%BA%A4%E7%94%B1%E5%A4%96%E9%83%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.5.</span> <span class="toc-text">D、第四种，存储任务交由外部组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-Pulsar-%E7%9A%84%E5%BF%AB%E9%80%9F%E6%89%A9%E7%BC%A9%E5%AE%B9%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">Apache Pulsar 的快速扩缩容方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-RocketMQ-%E5%BF%AB%E9%80%9F%E6%89%A9%E5%AE%B9%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">Apache RocketMQ 快速扩容方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-0-%E5%8F%8A%E4%BB%A5%E5%89%8D%E7%89%88%E6%9C%AC"><span class="toc-number">1.3.1.</span> <span class="toc-text">4.0 及以前版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-0%E7%89%88%E6%9C%AC-%E9%A2%84%E8%A7%88%E7%89%88%EF%BC%8C8%E6%9C%8813%E6%97%A5%E5%88%9A%E5%8F%91%E5%B8%83"><span class="toc-number">1.3.2.</span> <span class="toc-text">5.0版本(预览版，8月13日刚发布)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mafka-%E5%BF%AB%E9%80%9F%E6%89%A9%E7%BC%A9%E5%AE%B9%E6%BC%94%E8%BF%9B%E8%AE%A1%E5%88%92"><span class="toc-number">2.</span> <span class="toc-text">Mafka 快速扩缩容演进计划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mafka%E7%9A%84%E7%8E%B0%E6%9C%89%E6%89%A9%E7%BC%A9%E5%AE%B9%E8%83%BD%E5%8A%9B"><span class="toc-number">2.1.</span> <span class="toc-text">Mafka的现有扩缩容能力</span></a></li></ol></li></ol></div></div><div class="post-content"><h1 id="业界全链路弹性伸缩调研"><a href="#业界全链路弹性伸缩调研" class="headerlink" title="业界全链路弹性伸缩调研"></a>业界全链路弹性伸缩调研</h1><h2 id="Apache-Kafka的快速扩缩容方法"><a href="#Apache-Kafka的快速扩缩容方法" class="headerlink" title="Apache Kafka的快速扩缩容方法"></a>Apache Kafka的快速扩缩容方法</h2><h3 id="架构特点-重存储，轻计算"><a href="#架构特点-重存储，轻计算" class="headerlink" title="架构特点-重存储，轻计算"></a>架构特点-重存储，轻计算</h3><p>整体架构上，Kafka是以文件形式存储消息的，如下图所示，在每个kafka server内，又有多个文件来存储消息，每个文件叫做分片(partition)。</p>
<blockquote>
<p>*注: 为了更容易理解kafka的扩容方式，以下介绍都省略了kafka内部controller，follower，以及副本和复制等方面的内容。</p>
</blockquote>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/p_offset.svg"></p>
<p>kafka server在接收到消息后，将消息顺序写的方式，落盘到磁盘文件上，用户在读取消息时也是以顺序方式读取消息。<br>因为整个文件读写都是顺序进行的，所以这种磁盘的使用方式速度特别快，效率也非常高，造就了Kafka高吞吐，低延迟的特性。<br>所以，整体上看，Kafka节点的资源压力主要来自于存储， <strong>磁盘IOPS</strong>的使用，以及<strong>磁盘空间</strong>的使用，使用部分内存作为pageCache来加快读写，对CPU的使用特别少。</p>
<p>对于Kafka来说，集群上的扩容分以下几种场景:</p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">单队列扩容</td>
<td align="left">单个队列流量徒增，单个业务大促等</td>
</tr>
<tr>
<td align="left">多队列扩容</td>
<td align="left">多个队列一起扩容</td>
</tr>
<tr>
<td align="left">缓解存量节点压力</td>
<td align="left">缓解单个节点的压力，比如磁盘容量，IOPS资源不足的问题，迁移部分分片到新增的节点上</td>
</tr>
<tr>
<td align="left">集群整体扩容</td>
<td align="left">依据集群整体数据指标，周期性做整体扩容，整个集群增加新机器，集群内所有分片做全量重平衡</td>
</tr>
</tbody></table>
<p><strong>针对这四种业务场景，主要由以下四种扩容方法：</strong></p>
<h3 id="A、第一种、扩容分片-集群内扩容"><a href="#A、第一种、扩容分片-集群内扩容" class="headerlink" title="A、第一种、扩容分片(集群内扩容)"></a>A、第一种、扩容分片(集群内扩容)</h3><p>如下图所示，一个kafka集群包含3个节点，整个集群有一个主题A，它有一个分片。当这个主题的量在增大以后，一个分片无法满足业务方消息的生产速度时，就需要扩容。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic7.svg"></p>
<p>当这个主题的量增大以后，一个分片无法满足业务方消息的生产速度时，可以扩容多个分片来分担写入请求。如下图所示，主题A扩容为两个分片，此时两个分片共同承担客户端的消息的写入，如果消息的总写入量是10k/s的话，每个分片承担一半，各自5k/s。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic10.svg"></p>
<p>上边这种扩容，把主题A的两个分片都放到了节点1上。但是每个kafka server的磁盘容量，以及磁盘的IOPS是有限的，当超限以后，单台kafka server的资源就会被用尽。</p>
<p>这时，可以再扩容分片，并将新的分片分配到其他节点，这时主题A有3个分片，每个分片承担1/3的写入量。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic11.svg"></p>
<p>以上集群内的扩容方式，实际上Kafka在运行时，一般是大集群的运行状态，集群创建时都有一定的容量冗余。</p>
<h3 id="B、第二种，扩容集群节点，承担新的分片"><a href="#B、第二种，扩容集群节点，承担新的分片" class="headerlink" title="B、第二种，扩容集群节点，承担新的分片"></a>B、第二种，扩容集群节点，承担新的分片</h3><p>如上边所述，当某个队列的容量不够时，第一种方法是在集群内通过扩容分片的方式来扩容。但是当整个集群内，每个节点的磁盘容量或IOPS都不足时，就需要用到第二种方法，扩容集群。</p>
<p>在当今云原生时代下，业界主要使用的是k8s 容器化来协助扩容。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic12.svg"></p>
<p>如上图，扩容前，集群只包含3个节点，broker 1 ,broker 2和broker 3，如果kafka broker实现容器化部署后，使用k8s operator可以手动或编程的方式，快速新建两个新的实例 broker4和broker5，并加入到集群内，整个过程在容器资源充足的情况下，用时是秒级(&lt;60s)别的，</p>
<p>当然，这两个新节点只有kafka服务在运行，并未承接新的数据。要想快速承接新的数据(消息)，可以把新增加的分片放置到新的节点上，快速分担流量，就是上边的集群内扩容分片的方法，如下图。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic15.svg"></p>
<h3 id="C、第三种，扩容集群，迁移存量分片"><a href="#C、第三种，扩容集群，迁移存量分片" class="headerlink" title="C、第三种，扩容集群，迁移存量分片"></a>C、第三种，扩容集群，迁移存量分片</h3><p>可以对原集群节点上的存量队列分片做移动，将存量分片移动到新增的机器上，来减轻老节点的负载，如下图所示。<br>通过把老节点broker1，broker2，broker 3上的分片，移动到新的节点上，来减轻老节点的磁盘和IOPS压力。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic13.svg"></p>
<p>使用这种方法时，当需要迁移的分片数据比较大时，会比较耗时，Kafka官方公司对此有一个功能增强，叫做分层存储。</p>
<p>所谓分层存储，就是将时间比较近的消息数据存放在kafka  server机器本地，比如3个小时内的数据，将稍微久的数据存放在廉价存储上，比如S3、Hadoop或EBS上，如下图所示:</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic18.svg"></p>
<p>开启分层存储后，历史数据迁移到外部存储上，kafka节点本地数据减少：</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic16.svg"></p>
<p>分层存储有两个个优势：</p>
<ol>
<li>因为本机存储的数据变少了，提升了集群的磁盘容量，也减轻了磁盘的都请求压力，等于变相的扩容了集群。</li>
<li>因为本机存储的数据变少了，上边第二种扩容方法里，迁移分片时，挪动的数据也减少了，提高了分片的迁移速度。</li>
</ol>
<h3 id="D、第四种，存储任务交由外部组件"><a href="#D、第四种，存储任务交由外部组件" class="headerlink" title="D、第四种，存储任务交由外部组件"></a>D、第四种，存储任务交由外部组件</h3><p>这种方法比较简单，拿外部存储来替换本地磁盘，比如Amazon EBS，部署方式如下图，本地Kafka集群可以不配置或少配置磁盘，部署时磁盘地址挂接到EBS上：</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic21.svg"></p>
<p>在需要扩容集群的时候，可以分别扩容Broker和 EBS 磁盘存储。Kafka集群扩容时，可以依靠k8s operator快速创建Kafka实例；而磁盘容量或IOPS需要扩容时，交由EBS来处理。</p>
<p>方案优点:</p>
<ol>
<li><p>集群扩缩容比较快。当CPU和内存达到上限后，可以由k8s operator快速扩容kafka实例；当磁盘容量、IOPS达到上限后，kafka自身无需扩容，可以直接扩容EBS。</p>
</li>
<li><p>Kafka集群宕机时，集群恢复速度快。kafka broker可以快速起一个新的实例起来，挂接到原节点对应的EBS上。不需要上边那样迁移分区数据。</p>
</li>
<li><p>kafka集群可以缩小副本数量。由于EBS自身有多副本容灾机制，因此kafka的副本可以适当缩小，比如从3副本缩小到2副本。</p>
</li>
</ol>
<p>方案劣势：</p>
<ol>
<li>kafka  zero copy特性无法使用，数据必须从外部存储拉取到kafka节点上，经过内核态和用户态的转换，消费性能会下降</li>
<li>多了一层网络访问，增加一个网络RTT时间，延迟受网络影响较大，性能可能会降低。<br><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic14.svg"></li>
</ol>
<h2 id="Apache-Pulsar-的快速扩缩容方法"><a href="#Apache-Pulsar-的快速扩缩容方法" class="headerlink" title="Apache Pulsar 的快速扩缩容方法"></a>Apache Pulsar 的快速扩缩容方法</h2><p>Pulsar实际上是两个开源组件的组合，Pulsar集群+BookKeeper集群，下图是Pulsar的架构概览：</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic8.svg"></p>
<p>Pulsar架构简述:</p>
<ol>
<li>Pulsar依赖一个开源项目Apache BookKeeper，使用它来做消息存储，而pulsar本身是一个无状态服务。</li>
<li>Apache BookKeeper是一个分布式的日志条目(log entry)存储服务。</li>
<li>Pulsar和b ookeeper都使用zookeeper来存储自己的元数据，并在启动时往zookkeeper上注册节点，来供其他节点或客户端发现自己。</li>
<li>zookeeper同时负责监控pulsar和bookkeeper的健康状态。</li>
</ol>
<p>由此可⻅，Pulsar是一个典型的“计算+存储”类型的消息队列，Pulsar本身只做消息队列层的概念抽象逻辑，真正的消息数据落地在BookKeeper中。<br>在扩容时，如果是因为“计算”不足，则可以直接扩pulsar集群，因为这个集群是无状态的，可以由k8s operator来快速实例话容器。<br>如果是因为”存储不足”，则可以直接扩容bookeeper，但客户端在写入bookeeper时一直保持Write Quorum数量，如下图所示。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic6.svg"></p>
<p>pulsar在扩缩容方面的优势和劣势如下。</p>
<p>优势:</p>
<ol>
<li>pulsar集群因为是无状态节点，所以扩容速度比较快。</li>
<li>bookkeeper集群扩容速度也很快，新加入的节点可以快速分担集群的压力。</li>
</ol>
<p>劣势:</p>
<ol>
<li>bookeeper集群在节点宕机后，仍然要迁移宕机节点的数据到其他节点上，需要一段时间。</li>
<li>bookeeper集群在扩容后，因为能很快使用新的机器，导致新的fragement会创建到新节点上，在消费数据时，需要跳跃到多个节点上拿数据，性能损失比较大。</li>
</ol>
<h2 id="Apache-RocketMQ-快速扩容方法"><a href="#Apache-RocketMQ-快速扩容方法" class="headerlink" title="Apache RocketMQ 快速扩容方法"></a>Apache RocketMQ 快速扩容方法</h2><h3 id="4-0-及以前版本"><a href="#4-0-及以前版本" class="headerlink" title="4.0 及以前版本"></a>4.0 及以前版本</h3><p>如下图所示，RocketMQ的集群是由多对主从节点在组成的，每一个对主从机器都是一个部署单元，消息数据可以分散在多个单元上。</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/pic19.svg"></p>
<p>在这种架构下，扩容集群时，只需要构建更多的主从对即可，新的单元可以很快分担流量。</p>
<p>RocketMQ在快速扩容方面的优势和劣势如下<br>优势：</p>
<ol>
<li>新加入的部署单元可以很快分担队列流量</li>
</ol>
<p>劣势：</p>
<ol>
<li>需要手动指定新单元需要分担流量的队列，在集群内队列数量很多时，这个操作比较繁琐。</li>
<li>由于RocketMQ没有像Kafka一样的集群迁移操作，当扩容新的单元后，新数据落到了新节点上，老数据依然在老节点上，消费这些数据只能还跳回到老节点消费，实际未分散消费带来的服务压力。</li>
</ol>
<h3 id="5-0版本-预览版，8月13日刚发布"><a href="#5-0版本-预览版，8月13日刚发布" class="headerlink" title="5.0版本(预览版，8月13日刚发布)"></a>5.0版本(预览版，8月13日刚发布)</h3><p><strong>5.0版本则发生了很大的变化，初步从发布资料来看，架构采用了可分可合的存算分离方案，如下图所示:</strong></p>
<p>*以下引用自infoQ: RocketMq 5.0架构</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/rocke_mq5.jpg"></p>
<p>SDK: 用户客户端<br>LB Group： 负载均衡器<br>CBroker: 计算前端<br>SBroker: 存储后端</p>
<p>左侧是存算分离部署场景，右侧是放到一个机器上来部署，可以作为sidecar方式并存，也可以糅合到一个进程。<br>两种方式并存的架构体系，RocketMQ官方给出的理由是：</p>
<blockquote>
<p>*以下引用自infoQ: RocketMq 5.0架构</p>
</blockquote>
<blockquote>
<p>通过可分可合的存储计算分离架构，用户可以同一进程启动存储和计算的功能，也可以将两者分开部署。分开部署后的计算节点可以做到“无状态”，一个接入点可代理所有流量，在云上结合新硬件内核旁路技术，可以降低分离部署带来的性能及延迟问题。而选择“存储计算一体化”架构，同时也能契合“就近计算”的趋势，也就是在最靠近数据的地方做计算。</p>
</blockquote>
<blockquote>
<p>林清山表示新版本在存储计算分离的架构选择上非常慎重：“首先我们认为在云上多租、多 VPC、多种接入方式的场景下是非常有必要的，存储计算分离后能够避免后端存储服务直接暴露给客户端，便于实现流量的管控、隔离、调度、权限管理。”</p>
</blockquote>
<blockquote>
<p>但是有利必有弊，除了带来延迟的上升、成本的增加以外，存储计算分离也会给线上运维带来巨大挑战。在大多数场景下，用户更希望的还是存储计算一体化的架构，开箱即用、性能高、延迟低、运维轻松，尤其是在大数据场景下，能够极大降低机器及流量成本。其实这个问题本质上还是由消息产品的特性决定的，消息相比于数据库，计算逻辑相对简单，拆分后往往会沦为无计算场景可发挥、存储节点也得不到简化的状态，这个从 Kafka 的架构演进也可以得到印证。”</p>
<p>“存储计算分离只是适应了部分场景，架构的演进还是要回归到客户的真实场景。”</p>
</blockquote>
<ol>
<li>解耦计算和存储，两者可以分开扩容。</li>
<li>依据“就近原则”，可以将计算单独部署在最靠近数据的地方。</li>
<li>云上多租、多 VPC、多种接入方式的场景下是非常有必要的，存储计算分离后能够避免后端存储服务直接暴露给客户端，便于实现流量的管控、隔离、调度、权限管理</li>
<li>有利必有弊，存算分离会带来延迟的上升，成本的增加，同时带来线上运维的巨大挑战。在多数场景下，用户还是希望存算一体化，开箱即用，高性能，低延迟，运维轻松。</li>
</ol>
<p>另外，打听阿里内部RcoketMQ的开发人员，说RocketMQ已经开始接入云盘，但是现在没有官方资料放出来。</p>
<h1 id="Mafka-快速扩缩容演进计划"><a href="#Mafka-快速扩缩容演进计划" class="headerlink" title="Mafka 快速扩缩容演进计划"></a>Mafka 快速扩缩容演进计划</h1><h2 id="Mafka的现有扩缩容能力"><a href="#Mafka的现有扩缩容能力" class="headerlink" title="Mafka的现有扩缩容能力"></a>Mafka的现有扩缩容能力</h2><p>因为Mafka底层基于Kafka来研发，其底层扩缩容原理和上述的Kafka是一样的，总结Kafka和Mafka现有的扩缩容能力如下:</p>
<p><img src="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/table1.png"></p>
<p>可以看出对于第三种扩容方法，存量数据迁移时，如果数据量比较大的时候，速度比较慢。</p>
<p>为了优化这个问题，可以有两种方案:</p>
<table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">优势</th>
<th align="left">劣势</th>
</tr>
</thead>
<tbody><tr>
<td align="left">一、现有Mafka架构+分层存储(Mstore)（扩容方法C增强）</td>
<td align="left"><ol><li>Mafka集群原本就是大集群模式，有足够的资源冗余来缓解业务的流量徒增。现有架构可以满足业务的全链路弹性伸缩需求，不需要太大变动。</li><li>充分利用本地盘的优势，提升热数据的读写速度。冷数据、历史数据迁移至远程存储，节约本机磁盘空间，降低成本。</li><li>无需对远程存储强依赖，减少三方组件影响，远程存储可用性不影响Mafka整体高可用性。</li><li>历史数据的读取不影响热数据的存取</li><li>现有架构稳定可靠，方案对整体架构变动小，结果可控</li><li>演进路线和官方相同，有庞大的社区来获取经验和帮助</li></ol></td>
<td align="left"><ol><li>存量数据分片已经很小了，但迁移时仍然需要一定的时间</li><li>新的功能feature，仍然需要社区的验证</li></ol></td>
</tr>
<tr>
<td align="left">二、Mafka + 外部存储 （扩容方法D、存算分离）</td>
<td align="left"><ol><li>存储层交由第三方组件维护，自身变成无状态节点，方便维护。</li><li>无状态节点的扩缩容，依靠k8s+容器化 速度会很快</li></ol></td>
<td align="left"><ol><li>Mafka本身主要是磁盘IO bound，基本无CPU运算，做存算分离拆分意义不大，额外增加一层风险和维护成本。而且即便拆分后，计算层利用率不高，徒增工作量。</li><li>多一层网络访问，数据写入和读取耗时会增高，性能有损失</li><li>Kafka零拷贝无法使用，消费性能会下降</li><li>历史数据读取、热数据读取粘合在一起，互相影响</li><li>可用性受存储影响，即便本地增加read cache热数据，可用性依然受远端存储影响。</li><li>从稳定性上来讲，整个链路多一个外部组件，而且存储的是核心数据，多一个风险，增加额外的维护成本。</li></ol></td>
</tr>
</tbody></table>
<p>参考:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/big-data/best-practices-for-running-apache-kafka-on-aws/">https://aws.amazon.com/blogs/big-data/best-practices-for-running-apache-kafka-on-aws/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.confluent.io/blog/deploying-apache-kafka-on-aws-elastic-block-store-ebs/">https://www.confluent.io/blog/deploying-apache-kafka-on-aws-elastic-block-store-ebs/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/rocketmq/wiki/RIP-20-Streaming-Tiered-Storage-Optimize">https://github.com/apache/rocketmq/wiki/RIP-20-Streaming-Tiered-Storage-Optimize</a></li>
</ol>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>Title: </span>Mafka全链路弹性伸缩演进策略</p><p><span>Author: </span>Rex Wang rexwang735@gmail.com</p><p><span>Date: </span>2021-07-22</p><p><span>Last Update: </span>2024-03-24</p><p><span>Blog Link: </span><a href="/2021/07/22/Mafka全链路弹性伸缩演进策略/">https://wangjunfei.com/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://wangjunfei.com/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/"></i></span></p><p><span>Copyright Declaration: </span>Plz credit the original source when reposting</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://wangjunfei.com/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/" data-id="cmc1cedqo000cdl829rz67z9p" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAAEmCAAAAADqr2IGAAAEkUlEQVR42u3bS27jSBAFwL7/pd3A7BqG5PcyKQyLDq4EWmKRwUXlz3/+xMfXf8f3M9+P/K+vVnl/te9XeH/lfPULDkyYMGHCdEumr7dHfisJbnuFV995j5ivnjw7JkyYMGF6BlN+W+9vbk//niwPFJIzxQvGhAkTJky/gGkfKLQEbU66Z8WECRMmTL+ZKb/F92nkVQT5WrNyMyZMmDBhehLTvj3ZnskftS3RtgHNxbVwTJgwYcJ0M6Z2cOdJnz8434QJEyZMmG7A9DU62i022fhnG/YsFKiviQkTJkyYjmXKC6mbZHW/SjI81BaU84IvJkyYMGE6lyl51LzkmueMeRG2bbtuBpJeImLChAkTpmOZ2sdONtQ2REi257ZE26budciCCRMmTJgOZEq26jwpnW3Deb6ZpMSb1DcKBTBhwoQJ0+2Zcsu89ZgUZPPzebG4rW0X6S4mTJgwYXoE0+zMjCxvRraNzOQ6dYiACRMmTJgOZ8ofKd+Sc5pN8pyXa2cF5TrWwIQJEyZMN2OaLT9rds5KyZ9+VXkYhAkTJkyYTmSatTDbTT0fnWmHhGbEbWKPCRMmTJjOZdoXUvMx0E1qug87Nv9SggkTJkyYnsS0Hx7Nq6N5iTZHb4vUeaCACRMmTJhOZ2o52iHRNixoU9M2WNkXsjFhwoQJ0/2ZZhedlU3bG52NEG1KvS/XxYQJEyZMhzMlieUGot3+Z63HYeI6G9zBhAkTJkyHMLXtwzYlbgOOWfPy2mJ0FD1hwoQJE6ZDmNqHzDfdpOnYhiNty3MfvmDChAkTptOZ2mZku823rdD95801MWHChAnT85j2m3R+nU1DcX+mDXT++SsmTJgwYTqcaVNCnT3wbJXZ3e5bm5gwYcKE6Vym/IE/sW23gzhXNUrzYOWHijgmTJgwYbo90yYhbMu77b9YzBqQm+Lvy29iwoQJE6YHMSXl3fx22+GepGS8SY/bISRMmDBhwvQkpnzb3mz27ea9qbVu0u9okhcTJkyYMN2eKb+tdqCnbWcmBdwcerb65uVhwoQJE6Z7MrUp5Se+n7cqkyvMBlV/uCtMmDBhwvQ4pmS0Jf/tMBIpy8p5yt0m+ZgwYcKE6VymzTbZjvK0j3TVEE87FPvyRWLChAkTpmOZ2sJoO8yaNxFnYcQnWrCYMGHChOlJTLMhztmgTB5k5IM7V42o/vB6MGHChAnTsUz5QMy+EPyJECHhbkdgf3hhmDBhwoTpEKY8oV1l1evXcFUqOxu3xYQJEyZMz2BKktJZSvmJlHiGNWu1YsKECROmc5mG+fGiHDwLKS7o1parFEVeTJgwYcJ0Y6b9sGnbSswp89BhNl1TtE4xYcKECdOxTJ+IKTas+SBOHqzs18WECRMmTKcz7Qdf8lJsW7RtU+JNqfeHMAgTJkyYMB3O1N7ELO64qkTbjhklK0bTu5gwYcKE6Vcy7YuwmxGc/FHbFiwmTJgwYfptTJ8bmsnLwZvUt0Ucpr6YMGHChOmWTPvt+aphmva3M+L69WPChAkTpmOZZo3DWRjRDqHOEtd9uHDBfBMmTJgwYfr/mf4CeB3wkjfOJQ0AAAAASUVORK5CYII=">Aktie</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kafka/" rel="tag">kafka</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pulsar/" rel="tag">pulsar</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rocketmq/" rel="tag">rocketmq</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a></li></ul></div><div class="post-nav"><a class="pre" href="/2021/08/14/%E8%BD%AF%E7%B4%A0%E8%B4%A8%E8%9E%BA%E6%97%8B%E4%B8%8A%E5%8D%87/">软素质螺旋上升</a><a class="next" href="/2021/07/14/Mafka-LRP/">Mafka长期发展规划(LRP)</a></div><div class="nofancybox" id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'true' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'FNjCNRwQqC3sTPP04DfRFIk9-gzGzoHsz',
  appKey:'LzCq5t6a6RTkwXQVr8xLk0yj',
  serverURLs:'',
  placeholder:'Please provide constructive and respectful feedback.',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://wangjunfei.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="Über"><img class="nofancybox" src="/img/avatar.png"/></a><p>Always be the best</p><a class="info-icon" href="mailto:rexwang735@gmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/jonefeewang" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/">分布式技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E4%BA%A4%E6%B5%81%E6%B2%9F%E9%80%9A/">务虚-交流沟通</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/">务虚-管理方法论</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/">磁盘读写优化</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Apache-Pulsar/" style="font-size: 15px;">Apache Pulsar</a> <a href="/tags/Apache-Bookkeeper/" style="font-size: 15px;">Apache Bookkeeper</a> <a href="/tags/Apache-Kafka/" style="font-size: 15px;">Apache Kafka</a> <a href="/tags/Apache-pulsar-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-kafka-RocketMQ/" style="font-size: 15px;">Apache pulsar 消息队列 kafka RocketMQ</a> <a href="/tags/Message-Queue/" style="font-size: 15px;">Message Queue</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Pulsar/" style="font-size: 15px;">Pulsar</a> <a href="/tags/StoneMQ/" style="font-size: 15px;">StoneMQ</a> <a href="/tags/kafka-raft-kraft-zookeeper/" style="font-size: 15px;">kafka raft kraft zookeeper</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/pulsar/" style="font-size: 15px;">pulsar</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">务虚-管理方法论</a> <a href="/tags/%E5%8D%8E%E4%B8%BA/" style="font-size: 15px;">华为</a> <a href="/tags/%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">管理方法论</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 15px;">管理</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E9%A2%86%E5%AF%BC%E6%A2%AF%E9%98%9F/" style="font-size: 15px;">务虚-领导梯队</a> <a href="/tags/%E5%8A%A1%E8%99%9A/" style="font-size: 15px;">务虚</a> <a href="/tags/%E5%8D%8F%E4%BD%9C/" style="font-size: 15px;">协作</a> <a href="/tags/%E8%BD%AF%E7%B4%A0%E8%B4%A8/" style="font-size: 15px;">软素质</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">分布式技术</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/consensus-algorithm/" style="font-size: 15px;">consensus algorithm</a> <a href="/tags/zab/" style="font-size: 15px;">zab</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%AE%AE/" style="font-size: 15px;">分布式协议</a> <a href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" style="font-size: 15px;">一致性算法</a> <a href="/tags/%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%BD%AF%E7%B4%A0%E8%B4%A8%E6%8F%90%E5%8D%87/" style="font-size: 15px;">方法论 软素质提升</a> <a href="/tags/kafka-netty-%E6%97%B6%E9%97%B4%E8%BD%AE/" style="font-size: 15px;">kafka netty 时间轮</a> <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 15px;">云原生</a> <a href="/tags/%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">流式计算</a> <a href="/tags/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/" style="font-size: 15px;">磁盘读写优化</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/06/18/Rewriting-Kafka-in-Rust-Async-Insights-and-Lessons-Learned/">Rewriting Kafka in Rust Async: Insights and Lessons Learned in Rust</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/02/10/Announcing-Stonemq-A-high-performance-and-efficient-message-queue-developed-in-Rust/">Announcing Stonemq: A high-performance and efficient message queue developed in Rust</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/25/Apache-Pulsar%E7%9A%84%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">Apache Pulsar的存储模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/">Apache pulsar对zookeeper的依赖和去除分析(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/">Apache pulsar对zookeeper的依赖和去除分析(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/10/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/">时间轮算法分析和应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/01/Kafka%E5%8E%BBZookeeper%E6%8F%AD%E7%A7%98/">Kafka去Zookeeper揭秘</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/15/PRFAQ%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/">「转」PRFAQ编写规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/13/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E6%B3%95%E8%AE%BA%E6%B1%87%E9%9B%86/">「转」几种常见的工作方法论汇集</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/08/14/%E8%BD%AF%E7%B4%A0%E8%B4%A8%E8%9E%BA%E6%97%8B%E4%B8%8A%E5%8D%87/">软素质螺旋上升</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Rex Wang.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>