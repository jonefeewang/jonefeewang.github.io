<!DOCTYPE html><html lang="en-US"><head><meta name="google-site-verification" content="IqPxX6jMzoqSIvuvpvuP9PCF7niBjR9EBY0UfP9MHEU"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Rex Wangs blog"><title>Apache pulsar对zookeeper的依赖和去除分析(二) | Rex Wang</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Apache pulsar对zookeeper的依赖和去除分析(二)</h1><a id="logo" href="/.">Rex Wang</a><p class="description">always be the best</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Apache pulsar对zookeeper的依赖和去除分析(二)</h1><div class="post-meta">2023-09-15<span> | </span><span class="category"><a href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.3k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 8</span><span class="post-meta-item-text"> Minutes</span></span></span></div><a class="disqus-comment-count" href="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/#vcomment"><span class="valine-comment-count" data-xid="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/"></span><span> Comment</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">架构简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">2.1.</span> <span class="toc-text">概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%88%E6%9D%A5%E7%9C%8B%E5%87%A0%E4%B8%AA%E5%87%A0%E4%B8%AA%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5"><span class="toc-number">2.2.</span> <span class="toc-text">先来看几个几个名词概念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">3.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Broker%E5%AF%B9Zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">Broker对Zookeeper的依赖总结</span></a></li></ol></div></div><div class="post-content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>Apache pulsar是近年来国内比较时髦的消息队列，而且是开源的产品，有不少国内的互联网公司都开始了使用了。针对开源的几个消息队列产品比较，可以参看我之前的一篇博客<a href="/2021/03/26/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%9A%E7%95%8C%E8%B0%83%E7%A0%94/" title="消息队列业界调研">&lt;&lt;消息队列业界调研&gt;&gt;</a>。Pulsar为什么现在比较火，说白了是搭上了”云原生”这趟车。在当今时代，任何互联网技术，特别是基础组件，如果没云原生化，出门别人都不好意思给你打招呼。特别是从2021年开始， 突然一切互联网技术都需要”云原生”了，其中隐情也是各有使然，当然这是另一个话题。(关于我在美团时负责的消息队列Mafka云原生化分析，可以参考我的这篇博客和 <a href="/2021/07/14/Mafka-LRP/" title="Mafka消息队列长期发展计划">&lt;&lt;消息队列Mafka列长期发展计划&gt;&gt;</a> 和 <a href="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/" title="Mafka全链路弹性伸缩演进策略">&lt;&lt;消息队列Mafka全链路弹性伸缩演进策略&gt;&gt;</a>  )Pulsar因为其”天然”的存算分离架构，和云原生讲究的弹性伸缩性(scalability)，品性特别符合，自然受到了大家特别的追捧。</p>
<p>关于pulsar架构的评价，可以参考我之前写的这篇博客<a href="/2021/03/26/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%9A%E7%95%8C%E8%B0%83%E7%A0%94/" title="消息队列业界调研">&lt;&lt;消息队列业界调研&gt;&gt;</a>。本系列文章主要分析下pulsar对zookeeper的依赖，因为在当前的架构下(本篇以pulsar 2.8版本分析)，pulsar对zookeeper是强依赖关系，说白了就是zookeeper一旦挂掉，pulsar整个集群也就挂掉了。因为之前我也有一篇博客分析kafka 去除zookeeper依赖<a href="/2021/12/01/Kafka%E5%8E%BBZookeeper%E6%8F%AD%E7%A7%98/" title="Kafka去Zookeeper揭秘">&lt;&lt;揭秘Kafka去Zookeeper技术&gt;&gt;</a>，本篇分析下bookkeeper对zookeeper的依赖，以及如何去除。因为涉及的内容比较多，会分为三篇博客来写，第一篇分析pulsar本身，即pulsar broker，第二篇分析 bookkeeper对zookeeper的依赖，就是本篇内容，第三篇 是临时加的，因为2023年5月份，pulsar官方出了一个类似kafka kraft的一致性组件(<a target="_blank" rel="noopener" href="https://streamnative.io/blog/moving-toward-zookeeper-less-apache-pulsar" title="moving-toward-zookeeper-less-apache-pulsar">moving-toward-zookeeper-less-apache-pulsar</a>)来去除pulsar对zookeeper的依赖，第三篇会重点分析下这个组件。</p>
<h1 id="架构简介"><a href="#架构简介" class="headerlink" title="架构简介"></a>架构简介</h1><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>在讨论细节之前先来重温下pulsar的架构，pulsar架构的详细介绍，可以参考我之前的博客<a href="/2021/03/26/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%9A%E7%95%8C%E8%B0%83%E7%A0%94/" title="消息队列业界调研">&lt;&lt;消息队列业界调研&gt;&gt;</a>一文<br><img src="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/pic5.svg"></p>
<ol>
<li>整个pulsar 分为broker和bookkeeper两大部分</li>
<li>broker 和 bookkeeper都依赖 zookeeper来做元数据存储</li>
<li>broker是无状态的计算层(有部分配置缓存和消息数据缓存)</li>
<li>bookkeeper是存储层, bookkeeper实际上是apache的另一个开源项目</li>
</ol>
<h2 id="先来看几个几个名词概念"><a href="#先来看几个几个名词概念" class="headerlink" title="先来看几个几个名词概念"></a>先来看几个几个名词概念</h2><ol>
<li><p>ledger<br>  ledger是bookkeeper中概念，代表一个流水账，一个ledger其实就是 pulsar中topic的一个partition。但是在bookkeeper内部实现里，ledger其实是一个虚拟的概念，没有物理实体或文件实体。它有多个sgement组成，因为bookkeeper把多个leger写入到同一个entry log内，不同的legder会相互间隔相连，属于同一个legder的entry会排列在一起。entry log会不断滚动，生产一段一段的文件，每一段称为一个sgement。</p>
</li>
<li><p>journal<br>   bookkeeper中的物理文件，journal是短暂存储.在接收到客户端的发送的消息后，先写入write cache，然后再异步落盘形成entry log, entryFile是长期存储的消息文件, 最后在写入journal，在经过group commit方式flush到磁盘落地后，再ack客户端发送消息成功。jornal只是为了恢复entry file而写的。</p>
</li>
<li><p>entry log<br> entry log 是bookkeeper中的物理文件，是消息数据的持久存储。可以在bookkeeper内配置entry log的目录，可以是一个或多个，每个目录只对应一个entry log，所有ledger都落盘到这个file内。这个跟journal比较像，都是所有ledger的消息数据，但是entry log里的数据是按照ledger排列的，方便读取，而且entry log 是异步刷盘，journal是raw的消息数据，是同步刷盘(group commit方式)。当bookkeeper机器宕机后，未落盘的entry log 数据，可以根据check point从journal内恢复，这就是journal作为短暂临时存储的目的。</p>
</li>
<li><p>index file<br> bookkeeper的存储是有几种实现(接口称为LedgerStorage)可选:     </p>
<ul>
<li>InterleavedLedgerStorage</li>
<li>SortedLedgerStorage</li>
<li>DbLedgerStorage</li>
</ul>
<p> 前两种实现使用index file物理文件来作为entry的索引查找，最后一种使用rocksDB来做索引查找. 主要是查找某个特定entry的位置，比如给一个entry ID和一个ledger ID，查找这个entry在哪个entry log file里,在文件内的offset是多少。</p>
</li>
<li><p>fragment<br> 在发送消息时，如果ensemble里有一个bookkeeper机器掉线，客户端会再选择一个ensemble，继续发送消息，每个ensemble对应的一批消息称为fragment </p>
</li>
<li><p>ensemble(EM)<br> 几个bookkeeper实例组成一组存储，比如整个集群有10台机器，选择其中5台作为一个ensemble，WQ设置为3，AQ设置为2.</p>
</li>
<li><p>WQ<br> write quorum 发送消息时，必须写入的bookkeeper机器数量。在实际项目实践中，WQ一般和ensemble设置为一致，防止产生striping(一部分entry在一台机器上，下一部分跳到了另外一批机器上)而降低读消息的效率    </p>
</li>
<li><p>AQ<br> ack quorum 发送消息时，必须收到ack的bookkeeper机器数量   </p>
</li>
<li><p>Fencing<br> 当第一个客户端掉线后，第二个客户端必须关闭第一个客户端发送消息时写入的ledger，在关闭之前防止之前的ledger再继续写入，会先做fence操作，防止之前的客户端继续写入，产生脑裂，因为bookkeeper中的一个ledger写入，不允许有两个客户端同时写入，客户端必须保障这一点。</p>
</li>
</ol>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>bookkeeper对客户端有一定的要求:</p>
<ul>
<li>bookkeeper要求客户端在写入ledger的时候，不允许两个客户端同时写入，客户端必须保障这一点</li>
<li>bookkeeper要求客户端在写入ledger的时候，ledger Id必须是顺序的，客户端必须保障这一点</li>
</ul>
<p>相对于pulsar整体架构来说，pulsar的broker就是bookkeeper的客户端，所以broker会强依赖zk，保障任何时候一个topic只能被一个broker所负责。bookkeeper本身是一个无脑的存储，上边所说的两个保障都需要客户端自己来做。</p>
<p>数据的副本，也是靠客户端来保障的，比如像EM=3, WQ=3,AC=2这样集群设定，一个ensemble有3台bookkeeper机器，write quorum是3，Ack quorum是2，那客户端在发送消息时，必须发送3次，保障每台机器都发送到，但是可以在收到2个bookkeeper的ack后就算成功。</p>
<p>所以，bookkeepe本身对zk的依赖来说不重，主要做集群内机器上下线通知，和一些元数据存储，下边来详细看下zk上的元数据。</p>
<h1 id="Broker对Zookeeper的依赖总结"><a href="#Broker对Zookeeper的依赖总结" class="headerlink" title="Broker对Zookeeper的依赖总结"></a>Broker对Zookeeper的依赖总结</h1><table>
<thead>
<tr>
<th>项目</th>
<th>zk 路径</th>
<th>value/children</th>
<th>备注</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>集群节点相关</td>
<td>/ledgers/available/[ip:port]</td>
<td>children</td>
<td>临时节点，当前在线的集群节点列表。客户端会来读取，创建新的ensemble</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/ledgers/cookie/[ip:port]</td>
<td>children</td>
<td>持久节点，broker启动时自动注册，用来核实bookkeeper节点整个生命周期的配置信息</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/ldegers/available/readonly/[ip:port]</td>
<td>children</td>
<td>启动时强制注册为readonly的节点，或者当磁盘无可用空间时转换为readonly，这样的节点无法接受写操作</td>
<td></td>
</tr>
<tr>
<td>ledger数据相关的</td>
<td>/ledgers/00/0000/L000X</td>
<td>value</td>
<td>ledger的metadata信息，例如每个fragment的ledger id范围，方便ledger读取时，确定ledger在哪台机器上</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/ledgers/idgen/ID-0000000000X</td>
<td>value</td>
<td>每次创建新ledger时，从这个节点获取一全局唯一的ledgerId</td>
<td></td>
</tr>
</tbody></table>
<p>从上边的列表，不难看出，zk在这里的作用分两类，第一个是集群节点上下线注册和通知，第二类是全局唯一的锁，比如ledger Id的生成，以及ledger metadata的写入和更新。第三类，完全是配置类型的存储。</p>
<p>第一类，节点在zk上的注册，如果有网络抖动的话，或者zk自身jvm gc会造成节点瞬间下线，如果抖动时间比较长，会影响单个节点，或整个集群的稳定性，特别是zk数据量大了以后，自身jvm gc造成长时间卡住或假死，会造成全部节点下线，可用性降为0。所以如果条件允许，作为节点注册上下线，探活一类的zk，一定不能存储太多的数据。如果ledger自身数量比较多，考虑拆分集群，或替换为持久节点，外部增加一个scanner组件来主动扫描有问题的节点，如果节点端口不响应，可以将持久节点状态置为dead状态，或删除(在美团时，美团消息队列Mafka就是这样做的)。</p>
<p>第二类，全局唯一锁，这个可以使用redis做一个简单全局锁，或其他分布式锁组件，以此来替换掉zk。</p>
<p>第三类，配置存储类的，可以迁移到kv或mysql一类的关系数据库里，避免zk数据量的线性增长。</p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>Title: </span>Apache pulsar对zookeeper的依赖和去除分析(二)</p><p><span>Author: </span>Rex Wang rexwang735@gmail.com</p><p><span>Date: </span>2023-09-15</p><p><span>Last Update: </span>2024-03-24</p><p><span>Blog Link: </span><a href="/2023/09/15/Apache-pulsar对zookeeper的依赖和去除分析-二/">https://wangjunfei.com/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://wangjunfei.com/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/"></i></span></p><p><span>Copyright Declaration: </span>Plz credit the original source when reposting</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://wangjunfei.com/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/" data-id="cmc1cedqn0006dl82as319pxe" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAAEmCAAAAADqr2IGAAAElElEQVR42u3ayU4bURAFUP7/p511RLDvrXpEfnB6ZRno4TRSjR8f8fH4dHz+vv3m8+fnV/z8m8/P8/yeP77jwIQJEyZMb8n0eHq0TO11v/rcvpjNdZNXggkTJkyYbmdqH+Mr6DzMt/fQXn2WRnz5PSZMmDBh+mVMz29ill4kIbzlniUTmDBhwoQJU3KGPCFom8s5d/LCMGHChAnTb2DKT5c0eZ9DzJrIM5Rj58eECRMmTNcy7UeP937+lv0mTJgwYcL0NkyP8sjXX/I266aIbYvbx+jAhAkTJkz3MuUBMn+A7ygpZ8us7QjzxfNiwoQJE6YLmZ4/Xh5EN+E2uYdZZdoupEZ5EyZMmDBhupZpswTTBv5TQ8p2jTUvzg/fLiZMmDBhegOmtoG7Cduz5dFZ63ZfxmPChAkTptuZ8tuqQ2k5jJy9qs0Vo9YwJkyYMGG6nClv8rapwKxknY0hN+3jF/eGCRMmTJguZ8qLw/yBNws0SQj/jjL7y/NjwoQJE6ZrmTaDxvz7GW4btpOVnTw5eIGFCRMmTJguYcpvcbMemofwvMXcrgfl1yp64ZgwYcKE6RKm5GL7Aecm1ZgNU2fF9j9+HxMmTJgwXcuUL7JEY78y2M9WdtoB56nXjwkTJkyYbmRKQnJSgs4K5gTl/wT+4v8IEyZMmDBdyDQbJea3nj9A297dpAvFPwQmTJgwYbqWad/GbYN6HuzbdvAsCSgSC0yYMGHCdCFTvliTr8XkgXx2lVmTd5McYMKECROm25naBzvVGm7ThXxEunlhUZMXEyZMmDBdwnSqjZsH4H2Tt3ikoyNYTJgwYcJ0I9Oshdq2fffjz5zj1FrSP6a+mDBhwoTpWqY2g9gvmLYPnxerZ1OHj02ihQkTJkyY3oyp/SZZEs1byTlK+1f7n2LChAkTpnuZ8vIyL4Dbs+2HmptGcF4wY8KECROmG5k2KzJ5yN+v9eRYM6YXyQ0mTJgwYbqWqV3KKQrF0QPPyuPZU7TFNiZMmDBhupFpv5STB9S8KXzqFbZLsS9SAUyYMGHCdC1TvkLaro227d3NSuupgrnYb8KECRMmTG/PNAvz7Ziw/dvNcmq7+lM/IyZMmDBhuoqpDaWz9muSfOzL6TYpKdIdTJgwYcL0I5jOtmLbVdT2KnlBOxtqFifFhAkTJkxXMQ1PVK60tuXxozzahOBFQY4JEyZMmC5nOrWNmbSDT5XZbYowK78xYcKECdNPYspHgPskYFYq5zRnh6aYMGHChOlnMM2as/n4cLgSui5fN+NSTJgwYcJ0O9MsJOfl7iy92CcQs9dQvDBMmDBhwnQJ02ZMuCmDE/T8DMlQtl2l/eunmDBhwoTpWqa21MzThbbV244tzw4yP04dmDBhwoTpLZmSJCAvffNwOxtkPg/wm7L8RRKACRMmTJguZ2oD6mwtdVZSzsrUWeAfzn4xYcKECdOPY8pvJX+MNh1p05oDQ01MmDBhwvRrmNq/Sh6vHVjOfnNIjAkTJkyYLmc61Ritm6flsHPGsbl/TJgwYcJ0O1NbEM5WSNuSteXIh5qnimRMmDBhwvT2TH8Aw44mBpAIoGEAAAAASUVORK5CYII=">Aktie</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache-Bookkeeper/" rel="tag">Apache Bookkeeper</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache-Kafka/" rel="tag">Apache Kafka</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache-Pulsar/" rel="tag">Apache Pulsar</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/12/25/Apache-Pulsar%E7%9A%84%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">Apache Pulsar的存储模型</a><a class="next" href="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/">Apache pulsar对zookeeper的依赖和去除分析(一)</a></div><div class="nofancybox" id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'true' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'FNjCNRwQqC3sTPP04DfRFIk9-gzGzoHsz',
  appKey:'LzCq5t6a6RTkwXQVr8xLk0yj',
  serverURLs:'',
  placeholder:'Please provide constructive and respectful feedback.',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://wangjunfei.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="Über"><img class="nofancybox" src="/img/avatar.png"/></a><p>Always be the best</p><a class="info-icon" href="mailto:rexwang735@gmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/jonefeewang" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/">分布式技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E4%BA%A4%E6%B5%81%E6%B2%9F%E9%80%9A/">务虚-交流沟通</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/">务虚-管理方法论</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/">磁盘读写优化</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Apache-Pulsar/" style="font-size: 15px;">Apache Pulsar</a> <a href="/tags/Apache-Bookkeeper/" style="font-size: 15px;">Apache Bookkeeper</a> <a href="/tags/Apache-Kafka/" style="font-size: 15px;">Apache Kafka</a> <a href="/tags/Apache-pulsar-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-kafka-RocketMQ/" style="font-size: 15px;">Apache pulsar 消息队列 kafka RocketMQ</a> <a href="/tags/Message-Queue/" style="font-size: 15px;">Message Queue</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Pulsar/" style="font-size: 15px;">Pulsar</a> <a href="/tags/StoneMQ/" style="font-size: 15px;">StoneMQ</a> <a href="/tags/kafka-raft-kraft-zookeeper/" style="font-size: 15px;">kafka raft kraft zookeeper</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/pulsar/" style="font-size: 15px;">pulsar</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">务虚-管理方法论</a> <a href="/tags/%E5%8D%8E%E4%B8%BA/" style="font-size: 15px;">华为</a> <a href="/tags/%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">管理方法论</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 15px;">管理</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E9%A2%86%E5%AF%BC%E6%A2%AF%E9%98%9F/" style="font-size: 15px;">务虚-领导梯队</a> <a href="/tags/%E5%8A%A1%E8%99%9A/" style="font-size: 15px;">务虚</a> <a href="/tags/%E5%8D%8F%E4%BD%9C/" style="font-size: 15px;">协作</a> <a href="/tags/%E8%BD%AF%E7%B4%A0%E8%B4%A8/" style="font-size: 15px;">软素质</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">分布式技术</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/consensus-algorithm/" style="font-size: 15px;">consensus algorithm</a> <a href="/tags/zab/" style="font-size: 15px;">zab</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%AE%AE/" style="font-size: 15px;">分布式协议</a> <a href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" style="font-size: 15px;">一致性算法</a> <a href="/tags/%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%BD%AF%E7%B4%A0%E8%B4%A8%E6%8F%90%E5%8D%87/" style="font-size: 15px;">方法论 软素质提升</a> <a href="/tags/kafka-netty-%E6%97%B6%E9%97%B4%E8%BD%AE/" style="font-size: 15px;">kafka netty 时间轮</a> <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 15px;">云原生</a> <a href="/tags/%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">流式计算</a> <a href="/tags/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/" style="font-size: 15px;">磁盘读写优化</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/06/18/Rewriting-Kafka-in-Rust-Async-Insights-and-Lessons-Learned/">Rewriting Kafka in Rust Async: Insights and Lessons Learned in Rust</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/02/10/Announcing-Stonemq-A-high-performance-and-efficient-message-queue-developed-in-Rust/">Announcing Stonemq: A high-performance and efficient message queue developed in Rust</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/25/Apache-Pulsar%E7%9A%84%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">Apache Pulsar的存储模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/">Apache pulsar对zookeeper的依赖和去除分析(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/">Apache pulsar对zookeeper的依赖和去除分析(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/10/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/">时间轮算法分析和应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/01/Kafka%E5%8E%BBZookeeper%E6%8F%AD%E7%A7%98/">Kafka去Zookeeper揭秘</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/15/PRFAQ%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/">「转」PRFAQ编写规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/13/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E6%B3%95%E8%AE%BA%E6%B1%87%E9%9B%86/">「转」几种常见的工作方法论汇集</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/08/14/%E8%BD%AF%E7%B4%A0%E8%B4%A8%E8%9E%BA%E6%97%8B%E4%B8%8A%E5%8D%87/">软素质螺旋上升</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Rex Wang.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>