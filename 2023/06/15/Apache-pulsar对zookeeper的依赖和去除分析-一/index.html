<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="IqPxX6jMzoqSIvuvpvuP9PCF7niBjR9EBY0UfP9MHEU"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="王军飞的博客"><title>Apache pulsar对zookeeper的依赖和去除分析(一) | 王军飞的随笔</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Apache pulsar对zookeeper的依赖和去除分析(一)</h1><a id="logo" href="/.">王军飞的随笔</a><p class="description">always be the best</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Apache pulsar对zookeeper的依赖和去除分析(一)</h1><div class="post-meta">2023-06-15<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 15</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" href="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/#vcomment"><span class="valine-comment-count" data-xid="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">架构简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">2.1.</span> <span class="toc-text">概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E4%B8%AA%E5%AE%9E%E4%BD%93"><span class="toc-number">2.2.</span> <span class="toc-text">几个实体</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Broker%E5%AF%B9Zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">Broker对Zookeeper的依赖总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-topic%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">4.1.</span> <span class="toc-text">1.topic相关信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%8A%82%E7%82%B9%E5%B9%B6%E5%8F%91%E5%86%99zk%E5%AF%BC%E8%87%B4%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E6%8C%91%E6%88%98-bundle%E4%BF%A1%E6%81%AF%E5%B9%B6%E5%8F%91%E5%86%99-%E5%92%8C-bundle%E6%89%80%E6%9C%89%E6%9D%83%E5%A4%9A%E8%8A%82%E7%82%B9%E5%B9%B6%E5%8F%91%E6%8A%A2%E5%8D%A0"><span class="toc-number">4.1.1.</span> <span class="toc-text">多个节点并发写zk导致的一致性挑战: bundle信息并发写 和 bundle所有权多节点并发抢占</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bundle%E6%8B%86%E5%88%86%E4%BA%A7%E7%94%9F%E7%9A%84%E5%B9%B6%E5%8F%91%E5%86%99zk%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">bundle拆分产生的并发写zk操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bundle%E6%89%80%E6%9C%89%E6%9D%83%E6%8A%A2%E5%8D%A0%E4%BA%A7%E7%94%9F%E7%9A%84zk%E5%86%99%E7%AB%9E%E4%BA%89"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">bundle所有权抢占产生的zk写竞争</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84-topic%E7%9B%B8%E5%85%B3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.2.</span> <span class="toc-text">附 topic相关的操作:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-broker-%E8%8A%82%E7%82%B9%E7%9B%B8%E5%85%B3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">2.broker 节点相关的操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">3.配置相关的操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">思考</span></a></li></ol></div></div><div class="post-content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>Apache pulsar是近年来国内比较时髦的消息队列，而且是开源的产品，有不少国内的互联网公司都开始了使用了。针对开源的几个消息队列产品比较，可以参看我之前的一篇博客<a href="/2021/03/26/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%9A%E7%95%8C%E8%B0%83%E7%A0%94/" title="消息队列业界调研">&lt;&lt;消息队列业界调研&gt;&gt;</a>。Pulsar为什么现在比较火，说白了是搭上了”云原生”这趟车。在当今时代，任何互联网技术，特别是基础组件，如果没云原生化，出门别人都不好意思给你打招呼。特别是从2021年开始， 突然一切互联网技术都需要”云原生”了，其中隐情也是各有使然，当然这是另一个话题。(关于我在美团时负责的消息队列Mafka云原生化分析，可以参考我的这篇博客和 <a href="/2021/07/14/Mafka-LRP/" title="Mafka消息队列长期发展计划">&lt;&lt;消息队列Mafka列长期发展计划&gt;&gt;</a> 和 <a href="/2021/07/22/Mafka%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%BC%94%E8%BF%9B%E7%AD%96%E7%95%A5/" title="Mafka全链路弹性伸缩演进策略">&lt;&lt;消息队列Mafka全链路弹性伸缩演进策略&gt;&gt;</a>  )Pulsar因为其”天然”的存算分离架构，和云原生讲究的弹性伸缩性(scalability)，品性特别符合，自然受到了大家特别的追捧。</p>
<p>关于pulsar架构的评价，可以参考我之前写的这篇博客<a href="/2021/03/26/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%9A%E7%95%8C%E8%B0%83%E7%A0%94/" title="消息队列业界调研">&lt;&lt;消息队列业界调研&gt;&gt;</a>。本篇文章主要分析下pulsar对zookeeper的依赖，因为在当前的架构下(本篇以pulsar 2.8版本分析)，pulsar对zookeeper是强依赖关系，说白了就是zookeeper一旦挂掉，pulsar整个集群也就挂掉了。因为之前我也有一篇博客分析kafka 去除zookeeper依赖<a href="/2021/12/01/Kafka%E5%8E%BBZookeeper%E6%8F%AD%E7%A7%98/" title="Kafka去Zookeeper揭秘">&lt;&lt;揭秘Kafka去Zookeeper技术&gt;&gt;</a>，本篇分析下pulsar对zookeeper的依赖，以及如何去除。因为涉及的内容比较多，会分为三篇博客来写，第一篇分析pulsar本身，即pulsar broker，第二篇分析 bookkeeper对zookeeper的依赖，第三篇 是临时加的，因为2023年5月份，pulsar官方出了一个类似kafka kraft的一致性组件(<a target="_blank" rel="noopener" href="https://streamnative.io/blog/moving-toward-zookeeper-less-apache-pulsar" title="moving-toward-zookeeper-less-apache-pulsar">moving-toward-zookeeper-less-apache-pulsar</a>)来去除pulsar对zookeeper的依赖，第三篇会重点分析下这个组件。</p>
<h1 id="架构简介"><a href="#架构简介" class="headerlink" title="架构简介"></a>架构简介</h1><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>在讨论细节之前先来重温下pulsar的架构，pulsar架构的详细介绍，可以参考我之前的博客<a href="/2021/03/26/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%9A%E7%95%8C%E8%B0%83%E7%A0%94/" title="消息队列业界调研">&lt;&lt;消息队列业界调研&gt;&gt;</a>一文<br><img src="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/pic5.svg"></p>
<ol>
<li>整个pulsar 分为broker和bookkeeper两大部分</li>
<li>broker 和 bookkeeper都依赖 zookeeper来元做数据存储</li>
<li>broker是无状态的计算层(有部分配置缓存和消息数据缓存)</li>
<li>bookkeeper是存储层, bookkeeper实际上是apache的另一个开源项目</li>
</ol>
<h2 id="几个实体"><a href="#几个实体" class="headerlink" title="几个实体"></a>几个实体</h2><ol>
<li>topic<br> topic就是一个队列，pulsar中的 topic 对应bookkeeper中的一个ledger。多partition的队列就是多个队列组成的，对应多个Ledger。</li>
<li>group<br>  消费组</li>
<li>bundle<br>  队列集合。pulsar 使用hash算法，将多个队列归为一个集合，叫做bundle。bundle是一个虚拟实体，bundle 会被分配到不同的集群节点上，每个bundle 包含一部分队列。要计算topic在哪台节点上，需要先计算topic在哪个bundle里。 pulsar管理集群节点和topic的归属关系时，是以bundle为粒度的。</li>
<li>tenant<br> 租户</li>
<li>namespace<br> ns空间，命名空间</li>
<li>managed leger<br> pulsar包装的bookkeeper中的ledger</li>
<li>managed cursor<br>  pulsar抽象化的消息队列指针</li>
<li>policy<br>  namespace空间内使用的集群规则条目</li>
<li>local policy<br>  本集群内所有bundle的信息等</li>
</ol>
<h1 id="Broker对Zookeeper的依赖总结"><a href="#Broker对Zookeeper的依赖总结" class="headerlink" title="Broker对Zookeeper的依赖总结"></a>Broker对Zookeeper的依赖总结</h1><p>先来看下broker对zk依赖的总结列表</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>zk 路径</th>
<th>value/children</th>
<th>备注</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>pulsar polices定义都集中在/admin/polices目录下</td>
<td>/admin/policies</td>
<td>children</td>
<td>租户列表</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/admin/policies/[tenant]</td>
<td>children</td>
<td>namespace列表   初始化创建两个namespace： 1. public/default/ 2. pulsar/system/存放system topic</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/admin/policies/tenant/[namespace]</td>
<td>value</td>
<td>namespace 级别policies策略</td>
<td></td>
</tr>
<tr>
<td>bundle相关的数据</td>
<td>/admin/local-policies/[namespace名称]</td>
<td>value</td>
<td>集群内所有的 namespace下的所有bundle信息   节点的value值实际上是 LocalPolicies类的序列化</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/namespace/tenant/[namespace]</td>
<td>临时节点  value</td>
<td>bundle的owner信息 NamespaceEphemeralData[java类]: 节点服务信息ip和port一类</td>
<td></td>
</tr>
<tr>
<td>clusters</td>
<td>/admin/clusters</td>
<td>children</td>
<td>cluster列表</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/admin/clusters/[cluster]</td>
<td>value</td>
<td>cluster 信息数据 clusterData</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/admin/clusters/[cluster]/ namespaceIsolationPolicies</td>
<td>value</td>
<td>namespace isolation polices集群分组策略</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/admin/configuration</td>
<td>value</td>
<td>动态配置 DynamicConfiguration</td>
<td></td>
</tr>
<tr>
<td>brokers</td>
<td>/loadbalance/brokers</td>
<td>children</td>
<td>active brokers在线的broker</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/loadbalance/brokers/[ip:port]</td>
<td>临时节点 value</td>
<td>LocalBrokerData[java类]</td>
<td></td>
</tr>
<tr>
<td>topics</td>
<td>/managed-ledgers/[tenant]/[namespace]/persistent</td>
<td>children</td>
<td>topic信息</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/admin/partitionedTopic/[topic全名]</td>
<td>value</td>
<td>topic的partition信息</td>
<td></td>
</tr>
<tr>
<td>topic的ledger、cursor、消费组相关信息</td>
<td>/managed-ledgers/[topic全名]</td>
<td>value</td>
<td>topic的 ledger 数据，实际是java类 ManagedLedgerInfo的序列化</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/managed-ledgers/[topic全名]</td>
<td>children</td>
<td>topic 的消费组名称(同时也是cursor名称/cursor ledger名称)列表</td>
<td></td>
</tr>
<tr>
<td></td>
<td>/managed-ledgers/topic全名/[消费组名称]</td>
<td>value</td>
<td>消费组的cursor leger 信息 实际上是java类 ManagedCursorInfo的byte形式</td>
<td></td>
</tr>
</tbody></table>
<p>粗略分的话，大约分以下几类：</p>
<ol>
<li>topic相关信息： topic/group/bundle/ledger/cursor一类，这一类信息都是和topic相关的，但是集群在操作的时候都是以bundle粒度来操作的。要确定topic在哪台机器上，先确定topic属于哪个bundle.</li>
<li>broker相关信息: 集群内有多少个节点，每个节点当前的状态</li>
<li>配置类信息：tenant/namespace/cluster/动态配置/policy配置，这些信息都是涉及到整个集群配置的，创建、删除、修改都依赖zk的增删改查</li>
</ol>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><h2 id="1-topic相关信息"><a href="#1-topic相关信息" class="headerlink" title="1.topic相关信息"></a>1.topic相关信息</h2><p>上边说过，pulsar集群在操作topic时，是以bundle为粒度，一个bundle包含一批topic。bundle 被集群内的不同节点持有，哪个节点持有某个bundle，它就负责这些topic相关的操作，比如创建和删除topic /group/ledger/cursor等信息。</p>
<p>bundle 信息存储在zk上两个节点下:</p>
<ul>
<li><p><code>/admin/local-policies/[namespace名称]</code> 下Value值，存放着localPolicies对象的序列化信息，localPolicies对象里含有bundleData信息，bundleData主要包含三个条目:这个namespace下所有bundle的数量，每个bundle之间的界限范围列表，比如(0x00000000，0x100000000，0x200000000)</p>
</li>
<li><p><code>/namespace/[namespace名称]/[localhost:8080]/[0x00000000_0xffffffff]</code> ，即/namespace/[bundle名称]的Value 值，是一个临时节点，存放了SelfOwnerInfo(java类，包含nativeUrl,httpUrl)，就是包含这个bundle的节点信息的序列化串</p>
</li>
</ul>
<p>同时这两个节点也会在Pulsar的java类<code>NamespaceBundleFactory</code>和<code>OwnershipCache</code>中形成一个cache信息。</p>
<p>跟bundle关系紧密的类还包括java类<code>NamespaceService</code>。这个类主要是来服务bundle信息的，比如确定bundle在哪台broker上，获取一个bundle等，确定topic属于哪个bundle。</p>
<h3 id="多个节点并发写zk导致的一致性挑战-bundle信息并发写-和-bundle所有权多节点并发抢占"><a href="#多个节点并发写zk导致的一致性挑战-bundle信息并发写-和-bundle所有权多节点并发抢占" class="headerlink" title="多个节点并发写zk导致的一致性挑战: bundle信息并发写 和 bundle所有权多节点并发抢占"></a>多个节点并发写zk导致的一致性挑战: bundle信息并发写 和 bundle所有权多节点并发抢占</h3><p>因为 bundle 在 pulsar内被设计为可以在多个节点之间漂移的，同时也是可以被分裂成多个bundle的，所以bundle信息在zk上write和update等维护操作会在集群内多个节点之间产生并发竞争。</p>
<h4 id="bundle拆分产生的并发写zk操作"><a href="#bundle拆分产生的并发写zk操作" class="headerlink" title="bundle拆分产生的并发写zk操作"></a>bundle拆分产生的并发写zk操作</h4><p>namespace和bundle信息在zk上的path如下:</p>
<figure class="highlight prolog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/admin/local-polices/[ns1]     -&gt; [value]  localPolices</span><br><span class="line">                    [ns2].</span><br><span class="line">                    [ns3]·</span><br></pre></td></tr></tbody></table></figure>
<p>namespaceBundleFactory类有一个重要属性bundlesCache，这个cache内有每个namespace和其所有的bundle组成的KV缓存。<br>这个cache 也是异步加载的，需要人为来触发，当来一个lookup请求，需要知道哪个机器负责这个bundle时，就会触发当前topic所属namespace的缓存加载，加载时会load当前namespace所包含的所有bundle信息。这个KV缓存不止缓存本机拥有的bundle的namespace，他会包含所有被服务过的toipc的namespace。</p>
<p>实际加载动作由doLoadBundle完成:  从zk上读取bundle信息，反序列化成localPolicies，同时会保留一个pulsar自己的通过zk state构造的Sate里的version信息，是long型值，这些信息都会保存在KV缓存Value 里的Namespacebundles对象内， 将来做bundle拆分时，需要将拆分后的bundle信息回写到zk上时，这时会产生多个broker节点并发写zk的情况，因为这里存储的是某个namespace负责的所有bundle信息，其他broker也有拿到这个namespace下某一个bundle的所有权，做bundle拆分时，也会更新bundles 总信息，这时就要有一个一致性协调者zk，更新zk信息时，需要比较上次缓存的version信息和zk上现在的version信息时是否相等，避免覆盖其他人写的值。这个version在这里的作用，其实还是为了确保自己缓存的zk 数据信息是最新，防止将旧的数据会写到zk上。</p>
<h4 id="bundle所有权抢占产生的zk写竞争"><a href="#bundle所有权抢占产生的zk写竞争" class="headerlink" title="bundle所有权抢占产生的zk写竞争"></a>bundle所有权抢占产生的zk写竞争</h4><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/namespace/</span><br><span class="line">    <span class="selector-attr">[ns1]</span>/<span class="selector-attr">[0x00000000-0xfffffff0]</span>    -&gt; <span class="selector-attr">[value]</span> OwnedBundle</span><br><span class="line">    <span class="selector-attr">[ns1]</span>/<span class="selector-attr">[0xfffffff0-0xffffffff]</span></span><br></pre></td></tr></tbody></table></figure>

<p>NameSpaceService里的重要属性ownerShipCache对象，这个对象拥有一个重要的KV缓存属性，key是NamespaceBundlezNode，value是ownedBundle，简单说key就是一个bundle在 zk 上的路径(/namespace/[namespaceName]/[bundleRange])，zk上对应的value是bundle对象的序列化。这个缓存保存了当前节点拥有的bundle列表，这些信息在OwnerShipCache里保存了一份，同时也会保存在zookeeper上。当前broker 负责的bundle信息，在zk上保存的是一个临时节点，因为当前broker如果宕机了，zk链接就会断开，临时节点就会丢掉，当前broker释放bundle的所有权，以期望其他broker能获取。</p>
<p>注意这个cache不是自动创建的，必须有人来触发他，比如有一个lookup请求打到这个节点上时，broker 需要直到这个topic所属于哪个bundle，并且会从本机的这个缓存里查找一下，看自己是否拥有这个bundle。如果拥有，则正常返回。如果不拥有这个bundle，则会再从zk上查一下谁当前拥有这个bundle。这里查询的时候，如果查到这个节点已经存在，则会比较下节点创建的zk sessionId，和当前的sessionId是否相等，并且负责这个bundle的broker的url是否也相等，如果都相等的话，则认为是自己负责的。注意，这时其实发生了zk和本机缓存不一致的情况，zk上的临时节点是自己创建的，但是本机缓存却不存在，这里实际上是做了一次补偿，来统一zk数据和本机缓存数据。如果不想等，则会认为是其他人拥有这个bundle，会将请求打到真正负责这个bundle的broker上。如果没人拥有这个bundle，会触发让leader选取一个合适的候选节点来负责这个bundle。如果候选节点是本机，则当前broker会尝试获取这个bundle，把这个bundle负责起来。<br>尝试获取bundle的时候，实际发生了 zk 的并发抢占，当其他节点也发现无人负责这个bundle时，很有可能也去抢占获取这个bundle，所以这时需要一个zk的一致性机制来保障。</p>
<p>copy polices to local polices: 把polices里的bundle信息保存到local policies里，保存时，期望zk里的version是 -1，其目的是表明是自己来完成初次的local polices的构造，防止覆盖了其他人的写。</p>
<p><strong>总体来看</strong>，<ins>namespace下所有bundle信息的维护，bundle的拆分，以及拆分后每个bundle的所有者分配，完全可以交由集群的leader来维护，避免多个节点都去执行写操作，产生并发写竞争。避免因为并发写，而必须引入zookeeper这个一致性协调者。所有的写操作，都可以交由leader来完成，leader和其他节点的通信，使用epoch方式来保障，确保集群内所有的节点对当前leader 有统一和一致的认识，这点可以参考Kafka类似的系统。</ins> </p>
<p><strong>当bundle信息确定后</strong>，<ins>每个节点都有负责的一组固定的bundle，一个bundle对应着一批topic，topic的ledger信息、cursor信息、group 信息都有topic所在的节点自己来负责，对zk的读写操作基本都是低频的，即便发生并发，在单节点、单jvm内使用普通的java并发工具包类也是很好控制的，基本不涉及到多个节点的并发。因此这类操作，基本是拿zk当存储来使用，并没有使用到zk的全局一致性保障功能。</ins></p>
<h3 id="附-topic相关的操作"><a href="#附-topic相关的操作" class="headerlink" title="附 topic相关的操作:"></a>附 topic相关的操作:</h3><div style="color: #6E7173">

<p>ledger、cursor 相关的topic操作列表，以及访问zk的操作</p>
<ol>
<li>topic创建<br>创建ledger，保存ledger信息到zk</li>
<li>group创建<br>创建cursor ledger，保存cursor ledger信息到zk。分区topic 的 group创建是分别给每个分区的topic轮流创建一遍。</li>
<li>producer创建<br>无zk操作。分区topic的producer创建也是按分区个数轮流创建。</li>
<li>send操作<br>当前ledger添加满之后，创建新的ledger，保存新的ledger信息到zk</li>
<li>consume操作<br>消息拉取委托managedCursor来完成，本身无相关的 zk 操作。</li>
<li>客户端ack消息<br>ack的消息和位点信息，最终会构造为一个PositionInfo的对象，序列化之后添加到cursor ledger中，cursor ledger虽然也是一个ledger，但不同的是这个ledger只会有一个，当当前ledger添加满了之后，topic的ledger会负责创建一个新的ledger来存储位点信息。</li>
</ol>
<p>这些都没有涉及到zk的操作。只有创建cursor ledger时，需要将这个ledger信息保存到zk上。<br>同时，当ack消息添加到cursor ledger失败时，或关闭cursor时，或cursor ledger发生切换时，才会将位点信息补写一份到zk的cursor 节点value中。</p>
</div>

<h2 id="2-broker-节点相关的操作"><a href="#2-broker-节点相关的操作" class="headerlink" title="2.broker 节点相关的操作"></a>2.broker 节点相关的操作</h2><p>broker 节点相关的zk操作基本都在<code>/loadbalance/</code>节点下，节点上线、下线会导致创建或删除临时节点，这一部分和负载均衡的逻辑在一起。所有broker会定时将本机的负载数据，写到zk上，内容是LocalBrokerData类对象的json序列化,路径是<code>/loadbalance/broker-time-average/[ip]</code>。</p>
<p>集群会首先选出一个leader，leader会启动一个loadSheddingTask和一个LoadResourceQuotaTask，前者会根据集群当前的负载信息卸载需要均衡的bundle，后者会综合所有 broker 上报的系统负载信息和bundle信息计算出长期、短期两个维度的负载信息，再更新到zk上，内容是TimeAverageBrokerData对象的json序列化，zk 路径是<code>/loadbalance/broker-time-average/[ip]</code>。这里leader broker和普通的broker往 zk 上上报的信息，<ins>使用的是不同节点，不涉及到zk的并发写，因此这里仍然是拿zk作为一个存储来使用的。</ins></p>
<h2 id="3-配置相关的操作"><a href="#3-配置相关的操作" class="headerlink" title="3.配置相关的操作"></a>3.配置相关的操作</h2><p>tenant/namespace/cluster/动态配置/policy配置，这些信息都是涉及到整个集群配置的，创建、删除、修改都依赖zk的增删改查。这些信息都是集群的静态配置，目前是每个集群节点都可以去操作zk来处理这些请求的，同样也是通过zk的返回代码来判断是否有并发写。依据前面topic信息一类的分析，仍然是可以由集群leader来独自完成的，避免对zk的并发写。</p>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>如果使用epoch的方法，所有的集群操作都由leader来完成，leader 会不会变成一个单点风险？ 确实会，不过这时可以用zk来做一个抢占临时节点来选出集群leader，其他所有的集群写操作都由leader来完成，需要存储的数据由关系数据库或kv来完成(这一项我们在美团递消息队列Mafka castle的模块改动上有实践过)。这是第一个需要zk的地方，由zk来辅助选出集群的一个leader。第二个是集群节点的上下线也需要zk来监控和通知leader，这也是zk所擅长的。如果完全靠leader来检测其他节点，则需要通过节点间RPC调用，配合心跳健康检查，来确定其他节点的上下线，相当于自己实现了一遍zk的功能。</p>
<p>如果都由leader来完成，leader会不会称为一个瓶颈点？不会，总结上边会触发zk写操作的事件，相比收发消息一类的请求来说，都不是一个量级的，所以leader节点不会是一个瓶颈点。如果实在担心，可以将leader节点设置为纯 leader，不承载任何 bundle 数据，不接受消息收发类的数据请求，这点我们在美团消息队列Mafka上使用过。还可以将数据请求操作和集群管理操作做分类，leader 节点在处理请求时，优先处理管理类操作，也可以减轻leader节点的负担，就像是Kafka在1.1.0版本后的改动一样。</p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>Apache pulsar对zookeeper的依赖和去除分析(一)</p><p><span>文章作者：</span>王军飞 jonefeewang@gmail.com</p><p><span>发布时间：</span>2023-06-15</p><p><span>最后更新：</span>2024-03-24</p><p><span>原始链接：</span><a href="/2023/06/15/Apache-pulsar对zookeeper的依赖和去除分析-一/">https://wangjunfei.com/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://wangjunfei.com/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/"></i></span></p><p><span>版权声明：</span>原创文章转载请注明出处</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://wangjunfei.com/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/" data-id="cm7b7f8t100052f821r6ube7s" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAAEmCAAAAADqr2IGAAAEnElEQVR42u3bS3LbMBAFQN//0kpVtjHl92aYRJCaK5ctg2Bzgfnp6yu+Hr+v5Oc/r6vVrj5z9Zvkvs/vdbX+bRcmTJgwYXpJpsfT6/lW8u3mr2H2kvI1k1f7zf9iwoQJE6bDmWbL5Qd5+wKS0CEPUJLP/2CCCRMmTJg+gOk5R55Y5tAJ+iw5x4QJEyZMmNoksy2n5klysvImHMGECRMmTJ/AtFku/69NgzNJmzcr3FYLx4QJEyZML8Z07+DOWT//t/kmTJgwYcL0T5ge5dWmvvsjf19WblPib3aCCRMmTJiOZZqVaPNNz4Z1kvLu84ffxEdFhQATJkyYML08U170TIZg9oFC3vKc7XzWBMWECRMmTOcyzZqO+1GbVctwVI9tx5IwYcKECdMnMLXBQZL6zoqzybBOm6K3TVxMmDBhwnQi06wwmjcm8/S1hd4Uc5M0OKoQYMKECROmQ5g2B3ybduafSUKEfMyoDWu+CQgwYcKECdOBTNFxGKfEe4J8KHZWVt6PB2HChAkTprOY2gS1LcK2o6j5+vnwTbtaETdhwoQJE6ZDmO4NBWYjNbNkuy1Mz5J8TJgwYcJ0OlMOlB+oLV/bOm0HXvNU/Ju7YMKECROmN2XK09FZyTU5+Nsx1naoKGqgYsKECROmw5naAztJmPcvYDPQ8zW6igoBJkyYMGE6hClPEXOmfbtx1oBsg4B2DAgTJkyYMJ3IlGz0bwz37Ndvy7WrER9MmDBhwnQ40z5dnJViZ+norMi7GpPFhAkTJkzHMiWtxHuP7Vk7czYOO0vUL18nJkyYMGE6kGlTZm2bjnXCGR/V7Zc02vIxJkyYMGE6l2nDcfXYs3Bh0xDdhAjJypgwYcKE6XSm/CDPk8n8M23h9a5m57AYjQkTJkyYjmVKjtu7GoTtFy02O8kP/vpLHZgwYcKE6UCme4/VNq3dsM4KwcNgBRMmTJgwHcKUJ435Z2Yp9Kz1OGvH1rvChAkTJkxvwTR7yNkYzWwINSnC5k+Ul6QxYcKECdO5TG17Mmn17ZudSdDQprX5XS7TaUyYMGHCdCDThmCz9U2KOxvfycOLy5kmTJgwYcJ0INOshZkfwG2xeFZobtPmWYqOCRMmTJhOZ2oP3VlxNqdMdpXvYV+YxoQJEyZMJzLlR+9dwzrti2kLtZvxoB+6vpgwYcKE6UCm2bE6G8fZtC33j7ovImPChAkTphOZ2oXysmzeHJ3l622IMGvcYsKECROm92CaccxGfJLtzorFebm53hUmTJgwYXoLpjYRbYuz+9Ahb5rmrx8TJkyYML030131zDwp3bQ/N79p71jXxTFhwoQJ00syPcqrLaq2P29KsW2YUrROMWHChAnTsUyzIzkJBdoR1bvamXmY8jyMwIQJEyZM78TUBgHtqGjy178XfNw2uooJEyZMmA5nahPLPCxI1t8Unfd3iSImTJgwYcL0AUxtWBAdtEHjczYI2w4MRcM6mDBhwoTpY5jyQZy8ENy+gLuGgaIVMGHChAnT4UxtkbddZ//Y7TjRvrt7Qy0cEyZMmDC9ANPs+GwTyBl6XtLNQ5Ph7BImTJgwYTqP6Rd+HS5/7qwyvAAAAABJRU5ErkJggg==">分享</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache-pulsar-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-kafka-RocketMQ/" rel="tag">Apache pulsar 消息队列 kafka RocketMQ</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/">Apache pulsar对zookeeper的依赖和去除分析(二)</a><a class="next" href="/2023/04/10/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/">时间轮算法分析和应用</a></div><div class="nofancybox" id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'true' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'FNjCNRwQqC3sTPP04DfRFIk9-gzGzoHsz',
  appKey:'LzCq5t6a6RTkwXQVr8xLk0yj',
  serverURLs:'',
  placeholder:'请理性评论',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://wangjunfei.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.png"/></a><p>Always be the best</p><a class="info-icon" href="mailto:jonefeewang@outlook.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/jonefeewang" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/">分布式技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E4%BA%A4%E6%B5%81%E6%B2%9F%E9%80%9A/">务虚-交流沟通</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/">务虚-管理方法论</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/">磁盘读写优化</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Message-Queue/" style="font-size: 15px;">Message Queue</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Pulsar/" style="font-size: 15px;">Pulsar</a> <a href="/tags/StoneMQ/" style="font-size: 15px;">StoneMQ</a> <a href="/tags/Apache-Pulsar/" style="font-size: 15px;">Apache Pulsar</a> <a href="/tags/Apache-Bookkeeper/" style="font-size: 15px;">Apache Bookkeeper</a> <a href="/tags/Apache-Kafka/" style="font-size: 15px;">Apache Kafka</a> <a href="/tags/Apache-pulsar-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-kafka-RocketMQ/" style="font-size: 15px;">Apache pulsar 消息队列 kafka RocketMQ</a> <a href="/tags/kafka-raft-kraft-zookeeper/" style="font-size: 15px;">kafka raft kraft zookeeper</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/pulsar/" style="font-size: 15px;">pulsar</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">务虚-管理方法论</a> <a href="/tags/%E5%8D%8E%E4%B8%BA/" style="font-size: 15px;">华为</a> <a href="/tags/%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E8%AE%BA/" style="font-size: 15px;">管理方法论</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 15px;">管理</a> <a href="/tags/%E5%8A%A1%E8%99%9A-%E9%A2%86%E5%AF%BC%E6%A2%AF%E9%98%9F/" style="font-size: 15px;">务虚-领导梯队</a> <a href="/tags/%E5%8A%A1%E8%99%9A/" style="font-size: 15px;">务虚</a> <a href="/tags/%E5%8D%8F%E4%BD%9C/" style="font-size: 15px;">协作</a> <a href="/tags/%E8%BD%AF%E7%B4%A0%E8%B4%A8/" style="font-size: 15px;">软素质</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">分布式技术</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/consensus-algorithm/" style="font-size: 15px;">consensus algorithm</a> <a href="/tags/zab/" style="font-size: 15px;">zab</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%AE%AE/" style="font-size: 15px;">分布式协议</a> <a href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" style="font-size: 15px;">一致性算法</a> <a href="/tags/%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%BD%AF%E7%B4%A0%E8%B4%A8%E6%8F%90%E5%8D%87/" style="font-size: 15px;">方法论 软素质提升</a> <a href="/tags/kafka-netty-%E6%97%B6%E9%97%B4%E8%BD%AE/" style="font-size: 15px;">kafka netty 时间轮</a> <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 15px;">云原生</a> <a href="/tags/%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">流式计算</a> <a href="/tags/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/" style="font-size: 15px;">磁盘读写优化</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/02/20/resume/">resume</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/02/10/Announcing-Stonemq-A-high-performance-and-efficient-message-queue-developed-in-Rust/">Announcing Stonemq: A high-performance and efficient message queue developed in Rust</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/25/Apache-Pulsar%E7%9A%84%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">Apache Pulsar的存储模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%BA%8C/">Apache pulsar对zookeeper的依赖和去除分析(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/06/15/Apache-pulsar%E5%AF%B9zookeeper%E7%9A%84%E4%BE%9D%E8%B5%96%E5%92%8C%E5%8E%BB%E9%99%A4%E5%88%86%E6%9E%90-%E4%B8%80/">Apache pulsar对zookeeper的依赖和去除分析(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/10/%E6%97%B6%E9%97%B4%E8%BD%AE%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/">时间轮算法分析和应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/01/Kafka%E5%8E%BBZookeeper%E6%8F%AD%E7%A7%98/">Kafka去Zookeeper揭秘</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/15/PRFAQ%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/">「转」PRFAQ编写规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/13/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E6%B3%95%E8%AE%BA%E6%B1%87%E9%9B%86/">「转」几种常见的工作方法论汇集</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/08/14/%E8%BD%AF%E7%B4%A0%E8%B4%A8%E8%9E%BA%E6%97%8B%E4%B8%8A%E5%8D%87/">软素质螺旋上升</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">王军飞的随笔.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>